# Claude Code プロジェクト憲法

**最終更新**: 2025-11-29
**バージョン**: 2.0 (リファクタリング版)

---

## 🎯 このプロジェクトの開発哲学

### 原則

1. **実装前に計画する** - 「考えながら実装」ではなく、「計画してから実装」
2. **ドキュメントは実装と同時に書く** - 「後で書く」は禁止
3. **ブレない** - 計画に従い、計画外のことはしない
4. **記録する** - すべての決定、エラー、解決策を記録

---

## 🔄 実装ワークフロー（必須）

すべての実装は以下のフローに従ってください:

### Phase 1: 現状精査（実装開始前）

**チェックリスト**:
- [ ] `CURRENT-FOCUS.md`で今の状況を確認
- [ ] 該当機能のドキュメント確認
- [ ] `docs/project-knowledge/environment-variables.md`で必要な環境変数確認
- [ ] `docs/project-knowledge/tech-stack-map.md`で関連ファイル把握
- [ ] `docs/subscription/troubleshooting/error-database.md`で既知の問題確認

**成果物**: 現状の完全な理解

---

### Phase 2: 実装計画策定（実装開始前・必須）

**チェックリスト**:
- [ ] `docs/subscription/implementation-plans/TEMPLATE.md`をコピー
- [ ] 現状分析を詳細に記述
- [ ] 実装方針を明確化（なぜこの方法を選ぶか）
- [ ] 使用する環境変数を全てリストアップ
- [ ] 使用するライブラリ・APIを明記
- [ ] テストケースを定義
- [ ] リスクと対策を評価

**成果物**: `docs/subscription/implementation-plans/YYYY-MM-DD-task-name.md`

**重要**: この計画書を作成せずに実装を開始してはいけない

---

### Phase 3: 計画レビュー

**チェックリスト**:
- [ ] 計画を読み返す
- [ ] 不明点がないか確認
- [ ] ユーザーに承認を得る（必要に応じて）

---

### Phase 4: 実装

**チェックリスト**:
- [ ] 計画に従ってコーディング
- [ ] ブレない（計画外のことをしない）
- [ ] 小さく分割して進める
- [ ] こまめにテスト

**成果物**: 動作するコード

---

### Phase 5: ドキュメント更新（実装と並行）

**チェックリスト**:
- [ ] 環境変数を追加 → `environment-variables.md`更新
- [ ] 新機能を追加 → `tech-stack-map.md`更新
- [ ] 重要な決定 → `decision-log.md`更新
- [ ] エラー発生 → `error-database.md`更新

**成果物**: 常に最新のドキュメント

---

### Phase 6: 完了報告

**チェックリスト**:
- [ ] 実装計画に実施ログ追記
- [ ] TASK-TRACKER.md更新（該当する場合）
- [ ] CURRENT-FOCUS.md履歴更新

**成果物**: 完全な実装記録

---

## 📚 プロジェクト知識の管理

### 必ず参照・更新すべきドキュメント

#### 環境変数（environment-variables.md）
**いつ参照**: 実装開始前、エラー発生時
**いつ更新**: 新しい環境変数を追加した時

#### 技術マッピング（tech-stack-map.md）
**いつ参照**: 「この機能はどこ？」と思った時
**いつ更新**: 新しいファイル・機能を追加した時

#### 実装決定ログ（decision-log.md）
**いつ参照**: 「なぜこうなっているか？」と思った時
**いつ更新**: 重要な実装方針を決定した時

#### エラーデータベース（error-database.md）
**いつ参照**: エラーが発生した時
**いつ更新**: 新しいエラーに遭遇した時、解決した時

#### 実装計画（implementation-plans/）
**いつ作成**: 実装を開始する前（必須）
**いつ更新**: 実装中、完了時

---

## 📂 ドキュメント構造

```
.claude/
├── CLAUDE.md                              # このファイル（プロジェクト憲法）
├── CURRENT-FOCUS.md                       # 今取り組んでいること
├── PROJECT-RULES.md                       # 開発ルール
└── docs/
    ├── project-knowledge/                 # プロジェクト全体の知識
    │   ├── environment-variables.md       # 環境変数定義
    │   ├── tech-stack-map.md              # 技術マッピング
    │   └── decision-log.md                # 実装決定ログ
    └── subscription/
        ├── README.md                      # サブスクドキュメント索引
        ├── TASK-TRACKER.md                # タスク管理（該当する場合）
        ├── implementation-plans/          # 実装計画
        │   ├── TEMPLATE.md                # テンプレート
        │   └── YYYY-MM-DD-task-name.md    # 各実装の計画書
        ├── troubleshooting/               # トラブルシューティング
        │   ├── error-database.md          # エラーデータベース
        │   └── solutions-log.md           # 解決策ログ（任意）
        ├── specifications/                # システム仕様
        └── guides/                        # ガイド
```

---

## ⚠️ 禁止事項

以下の行為は**絶対に禁止**:

1. ❌ 実装計画を作成せずに実装開始
2. ❌ ドキュメントを読まずに作業開始
3. ❌ 計画と異なることを実装（ブレる）
4. ❌ 「後でドキュメント書く」（実装と同時に書く）
5. ❌ エラーを記録せずに放置
6. ❌ 環境変数を追加したのに environment-variables.mdを更新しない
7. ❌ テストせずにデプロイ
8. ❌ 本番環境で実験的な操作

---

## 🎯 このワークフローで実現すること

### 1. ミスのない実装
✅ 実装前に計画を立てるため、見落としがない
✅ 環境変数・技術定義が明確なため、設定ミスがない

### 2. ブレない修正
✅ 実装計画に「なぜこの方法」が記録されている
✅ 後から見返しても理由が分かる

### 3. 失敗時の原因追求
✅ エラーデータベースに過去の失敗が蓄積されている
✅ 同じエラーに遭遇しても即座に解決できる

### 4. スケーラブルな開発
✅ 新機能追加時も同じ構造を適用
✅ チーム全体で統一された方法で開発

---

## 🚀 クイックスタート（新しいタスクを始める時）

1. **CURRENT-FOCUS.mdを開く** - 今の状況確認
2. **該当機能のドキュメントを読む**
3. **environment-variables.mdで環境変数確認**
4. **tech-stack-map.mdで関連ファイル確認**
5. **error-database.mdで既知の問題確認**
6. **implementation-plans/TEMPLATE.mdをコピーして計画書作成**
7. **計画をレビュー**
8. **実装開始**

---

## 📝 更新履歴

| 日付 | 更新内容 |
|------|---------|
| 2025-11-29 | v2.0リファクタリング版（実装ワークフロー追加、ドキュメント構造再編） |
| 2025-11-28 | v1.0初版作成 |

---

**このワークフローを守ることで、ミスのない実装とブレない修正が可能になります。**
**全ての作業は、このルールに従って実施してください。**
