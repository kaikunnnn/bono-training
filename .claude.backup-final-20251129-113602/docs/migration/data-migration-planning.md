# 既存データ移行 - 要件ヒアリングシート

**作成日**: 2025-11-19
**目的**: 既存の Stripe 顧客・サブスクリプションデータを新システム（Supabase）に移行する

---

## 📝 このドキュメントの使い方

1. 以下の質問に回答を記入してください
2. 回答が完了したら、移行計画書を作成します
3. わからない項目は「不明」と記入してください

---

## 1️⃣ 既存システムの構成

### A. 現在の Stripe 顧客データ

**Q1: 既存の顧客は何人くらい存在していますか？**

- 回答: ******\_\_\_******2162

**Q2: 既存顧客の Stripe Customer ID は既に発行されていますか？**

- 回答: [○] はい / [ ] いいえ / [ ] 一部のみ

**Q3: 既存顧客のメールアドレスは、新システムの Supabase Auth のメールアドレスと一致していますか？**

- 回答: [ ] はい、全員一致 / [ ] 一部一致 / [ ] いいえ / [○] 不明
  Supabase を今は使ってないです。

---

### B. 現在のサブスクリプション状態

**Q4: アクティブなサブスクリプションは何件くらいありますか？**

- 回答: ******\_\_\_******250
- → アクティブなもの限定ではじめてもいいです（ただ前にアカウント作ったものがどうなるかが複雑にならなければ）

**Q5: サブスクリプションの種類は何がありますか？**

| プラン名 | 価格       | 期間           | 件数 |
| -------- | ---------- | -------------- | ---- |
| Standard | ¥6,800/月  | 1 ヶ月毎に更新 | ？   |
| Standard | ¥5,800/月  | 3 ヶ月毎に更新 | ？   |
| Standard | ¥15,800/月 | 1 ヶ月毎に更新 | ？   |
| Standard | ¥13,800/月 | 3 ヶ月毎に更新 | ？   |

**Q6: Stripe 上のサブスクリプションは現在も課金が継続していますか？**

- 回答: [○] はい / [ ] いいえ / [ ] 一部のみ

**Q6-補足: 継続している場合、今後も同じ課金を続けますか？**

- 回答: [○] はい / [ ] いいえ

---

## 2️⃣ 既存データの保存場所

### A. 顧客データの保存場所

**Q7: 既存の顧客データはどこに保存されていますか？**（複数選択可）

- [○] Stripe のみ
- [○] 別のデータベース（種類: MemberStack というサービスを使っています。そこにもデータはあります）
- [ ] スプレッドシート（Google Sheets / Excel）
- [ ] その他: ******\_\_\_******

**Q7-補足: データベースに保存されている場合、テーブル構造を教えてください**

```
例:
CREATE TABLE customers (
  id uuid PRIMARY KEY,
  email text,
  stripe_customer_id text,
  ...
);
```

回答:

```


```

---

### B. サブスクリプションデータの保存場所

**Q8: サブスクリプション状態はどこで管理されていますか？**（複数選択可）

- [○] Stripe のみ
- [○] 別のデータベース（種類:MemberStack というサービスを使っています。そこにもデータはあります）
- [ ] スプレッドシート
- [ ] その他: ******\_\_\_******

---

## 3️⃣ 新システムの Supabase データ

### A. Supabase Auth ユーザー

**Q9: 既存顧客は既に Supabase Auth にユーザー登録されていますか？**

- [ ] はい、全員登録済み
- [ ] 一部のみ登録済み（何人/全体: ******\_\_\_******）
- [○] まだ誰も登録していない

**Q10: 登録済みの場合、既存顧客のメールアドレスと Stripe のメールアドレスは一致していますか？**

- [ ] はい、全員一致
- [ ] 一部一致
- [ ] いいえ
- [○] 該当なし（Q9 で「誰も登録していない」を選択）

---

### B. 現在の Supabase テーブル

**Q11: `stripe_customers` テーブルに既にデータは入っていますか？**

- [ ] はい（件数: ******\_\_\_******）
- [ ] いいえ（空っぽ）
- [○] 不明 → 今テスト実装している内容を調べてください。決済の仕組みはこのレポジトリとブランチで開発してます。それを忘れないように.claude にまとめてください

**Q12: `user_subscriptions` テーブルに既にデータは入っていますか？**

- [ ] はい（件数: ******\_\_\_******）
- [ ] いいえ（空っぽ）
- [ ] 不明 → 今テスト実装している内容を調べてください。決済の仕組みはこのレポジトリとブランチで開発してます。それを忘れないように.claude にまとめてください

**Q12-補足: データがある場合、それは移行対象の既存顧客のデータですか？**

- [ ] はい
- [○] いいえ（テストデータなど）
- [ ] 両方混在している

---

## 4️⃣ データの紐付け

### A. ユーザー識別方法

**Q13: 既存顧客と新システムのユーザーを紐付けるキーは何ですか？**（最も確実なもの）

- [○] メールアドレス
- [○] Stripe Customer ID
- [ ] ユーザー ID（既存システムの ID）
- [ ] その他: ******\_\_\_******

→MemberStack の仕組みがよくわかってないです。基本的には Stripe のデータを使っている気がしているのですが必要があれば調べてみてほしいです。

**Q13-補足: メールアドレスで紐付ける場合、大文字小文字の違いはありますか？**

- 例: `user@example.com` と `User@Example.com` が別ユーザー？
- 回答: [ ] はい、別ユーザー / [ ] いいえ、同じユーザー / [ ] 不明

→ 一般的な仕様で良いと思っています。Stripe が認識しているものに合わせたいです。

---

### B. データの重複

**Q14: 同じメールアドレスで複数の Stripe 顧客が存在する可能性はありますか？**

- [ ] はい
- [○] いいえ
- [ ] 不明

**Q14-補足: 「はい」の場合、その理由を教えてください**

- 回答: ******\_\_\_******

**Q15: 同じユーザーが複数のサブスクリプションを持っている可能性はありますか？**

- [ ] はい
- [○] いいえ
- [ ] 不明

**Q15-補足: 「はい」の場合、どのように扱いますか？**

- [ ] 最新のサブスクリプションのみ移行
- [ ] 全て移行（複数保持）
- [ ] 手動で確認して決定
- [ ] その他: ******\_\_\_******

---

## 5️⃣ 移行のタイミングと影響

### A. サービスの停止

**Q16: 移行作業中、サービスを停止できますか？**

- [○] はい、数時間停止できる（何時間: ******\_\_\_******）
- [ ] いいえ、無停止で移行したい
- [ ] 深夜など、利用者が少ない時間帯なら停止可能
- [ ] その他: ******\_\_\_******

可能なら停止無しでいきたいですけどやむを得ないなら OK です。
ちなみに最初はテスト的にリリースしたいです。つまり今の仕組みのサイトを動かしながら、新サイトでも同じアカウントでログインでき、同じ仕組みを利用できる＝メンバー限定のコンテンツが閲覧できる

**Q16-補足: 停止できる場合、希望する日時はありますか？**

- 回答: ******\_\_\_******

---

### B. 課金への影響

**Q17: 移行中に新規の課金や解約が発生する可能性はありますか？**

- [○] はい
- [ ] いいえ
- [ ] 不明

**Q18: 移行失敗時、既存の Stripe サブスクリプションはそのまま継続させたいですか？**

- [○] はい、絶対に継続（課金を止めてはいけない）
- [ ] いいえ、一時停止してもよい
- [ ] その他: ******\_\_\_******

---

## 6️⃣ 移行後の動作

### A. 既存顧客の体験

**Q19: 移行後、既存顧客は何か操作が必要ですか？**

- [ ] ログインするだけで自動的に紐付けたい
- [ ] 初回ログイン時に何か設定が必要（内容: ******\_\_\_******）
- [ ] メールで通知して、ユーザー自身で設定してもらう
- [○] その他: わからないから最適な内容を提案してほしい

**Q19-補足: 既存顧客に移行をどのように周知しますか？**

- [ ] メール通知
- [ ] アプリ内通知
- [○] 特に通知しない（自動で移行）
- [ ] その他: ******\_\_\_******

→ 今の仕組みも動かしつつ、新しいものも動かす運用でリリースする前提でいるのですが、それは可能でしょうか？その場合は周知はそこまで仕組み的には必要ないと考えています

---

### B. サブスクリプションの継続

**Q20: 移行後も、既存の Stripe サブスクリプション ID をそのまま使い続けますか？**

- [○] はい、既存のサブスクリプション ID を維持（推奨）
- [ ] いいえ、新しいサブスクリプションを作成
- [ ] その他: ******\_\_\_******

→ ただ最適な方法があれば教えてほしいです

**Q20-補足: 新しいサブスクリプションを作成する場合、古いものはキャンセルしますか？**

- [ ] はい
- [○] いいえ
- [ ] 該当なし

→ 今課金がされているものを止めたくないです。

---

## 7️⃣ データの確認

### A. データサンプル

**Q21: 既存データのサンプルを提供できますか？**（個人情報は除く）

- [ ] はい（以下に記載またはファイル添付）
- [ ] いいえ
- [○] 後で提供　 → 方法を教えてくれれば可能です。

**サンプルデータ**:

```json
例:
{
  "stripe_customer_id": "cus_xxxxx",
  "email": "user@example.com",
  "subscription": {
    "id": "sub_xxxxx",
    "plan": "standard",
    "status": "active",
    "current_period_end": 1734480000
  }
}
```

回答:

```


```

---

### B. データのエクスポート

**Q22: 移行対象のデータを CSV や JSON でエクスポートできますか？**

- [ ] はい、すぐにエクスポートできる
- [ ] はい、時間はかかるができる
- [ ] いいえ、できない
- [○] 不明 Stripe と Memberstack を使っています調べてください

**Q22-補足: エクスポートできる場合、どの形式が良いですか？**

- [ ] CSV
- [ ] JSON
- [ ] SQL
- [ ] その他: ******\_\_\_******

---

## 8️⃣ 特殊なケース

### A. 例外的なデータ

**Q23: 以下のような例外的なケースはありますか？**

- [ ] 無料トライアル中のユーザー
- [○] 解約済みだが期間内のユーザー
- [ ] 支払い失敗で停止中のサブスクリプション
- [ ] 管理者が手動で設定した特別プラン
- [ ] その他: ******\_\_\_******

→ キャンセル済みでまだ更新日までは使える状態のユーザーが居る可能性があります

**Q23-補足: これらをどのように扱いますか？**

- 回答: ******\_\_\_******

→ キャンセル済みのステータスを引き継ぎ、更新日までは使えるようにしたい

---

### B. 移行の優先順位

**Q24: 移行の優先順位を教えてください**

1 位: アクティブなサブスクリプション
2 位: 解約済みだが期間内のユーザー
3 位: 過去に解約したユーザー

---

## 9️⃣ 成功の定義

### A. 移行成功の条件

**Q25: 移行が成功したと言える条件は何ですか？**（複数選択可）

- [○] 全ての既存顧客がログインできる
- [○] 全てのサブスクリプションが正しく表示される
- [○] 課金が正常に継続される
- [○] データの不整合がない（0 件）
- [ ] その他: ******\_\_\_******

---

### B. 許容できるエラー

**Q26: どの程度のエラーなら許容できますか？**

- [ ] エラー 0 件（完璧な移行が必要）
- [○] 1〜5 件程度なら許容（手動で修正）
- [○] 10 件以下なら許容
- [ ] その他: ******\_\_\_******

---

## 🔟 その他

### A. 追加の要望

**Q27: その他、移行について懸念していることや要望はありますか？**

回答:

```


```

---

### B. スケジュール

**Q28: 移行の希望時期はありますか？**

- 回答: 1 ヶ月か２週間

**Q29: テスト期間は必要ですか？**

- [ ] はい（期間: ******\_\_\_******）
- [ ] いいえ
- [ ] 不明

---

## ✅ 回答完了チェック

以下の重要な質問に回答済みか確認してください：

- [ ] Q1: 既存顧客数
- [ ] Q4: アクティブなサブスクリプション数
- [ ] Q9: Supabase Auth ユーザー登録状況
- [ ] Q13: ユーザー識別方法
- [ ] Q16: サービス停止の可否
- [ ] Q20: サブスクリプション ID の維持

---

## 📋 次のステップ

このドキュメントの回答が完了したら、以下を作成します：

1. **移行計画書** - 詳細な手順とタイムライン
2. **リスク分析** - 失敗パターンと対策
3. **移行スクリプト** - 自動化された安全な移行ツール
4. **ロールバック手順** - 問題発生時の復旧方法
5. **テスト計画** - 移行前後の検証項目

---

**記入者**: ******\_\_\_******
**記入日**: ******\_\_\_******
**確認者**: ******\_\_\_******
**確認日**: ******\_\_\_******
