# ãƒ•ã‚§ãƒ¼ã‚º3: ãƒã‚¤ãƒšãƒ¼ã‚¸ - ãƒ–ãƒƒã‚¯ãƒãƒ¼ã‚¯ä¸€è¦§è¡¨ç¤º

## ğŸ“‹ æ¦‚è¦

- **ç›®çš„**: ãƒ¦ãƒ¼ã‚¶ãƒ¼ãŒãƒ–ãƒƒã‚¯ãƒãƒ¼ã‚¯ã—ãŸè¨˜äº‹ã‚’ä¸€è¦§è¡¨ç¤ºã™ã‚‹å°‚ç”¨ãƒšãƒ¼ã‚¸ã‚’å®Ÿè£…
- **URL**: `/mypage`
- **æ‰€è¦æ™‚é–“**: 3-4æ™‚é–“

---

## ğŸ¯ ã“ã®ãƒ•ã‚§ãƒ¼ã‚ºã§å®Ÿè£…ã™ã‚‹ã‚‚ã®

### 1. ãƒã‚¤ãƒšãƒ¼ã‚¸ã®ä½œæˆ
- `/mypage` ãƒšãƒ¼ã‚¸ã‚’æ–°è¦ä½œæˆ
- ãƒ­ã‚°ã‚¤ãƒ³å¿…é ˆï¼ˆæœªãƒ­ã‚°ã‚¤ãƒ³æ™‚ã¯ `/auth` ã«ãƒªãƒ€ã‚¤ãƒ¬ã‚¯ãƒˆï¼‰
- ãƒ—ãƒ­ãƒ•ã‚£ãƒ¼ãƒ«ãƒšãƒ¼ã‚¸ (`/profile`) ã¸ã®å°ç·šã‚’è¿½åŠ 

### 2. ãƒ–ãƒƒã‚¯ãƒãƒ¼ã‚¯ä¸€è¦§è¡¨ç¤º
- ãƒ¦ãƒ¼ã‚¶ãƒ¼ã®ãƒ–ãƒƒã‚¯ãƒãƒ¼ã‚¯æ¸ˆã¿è¨˜äº‹ã‚’ãƒªã‚¹ãƒˆå½¢å¼ã§è¡¨ç¤º
- Supabaseã‹ã‚‰è¨˜äº‹IDã‚’å–å¾— â†’ Sanityã§Articleæƒ…å ±ã‚’å–å¾—
- è¡¨ç¤ºé …ç›®:
  - ã‚µãƒ ãƒã‚¤ãƒ«ç”»åƒ
  - è¨˜äº‹ã‚¿ã‚¤ãƒˆãƒ«
  - æ‰€å±ãƒ¬ãƒƒã‚¹ãƒ³å
  - æ¨å®šæ™‚é–“ï¼ˆåˆ†ï¼‰

### 3. ãƒŠãƒ“ã‚²ãƒ¼ã‚·ãƒ§ãƒ³ã®æ›´æ–°
- Sidebarã®ã€Œãƒã‚¤ãƒšãƒ¼ã‚¸ã€ãƒªãƒ³ã‚¯ã‚’ `/profile` â†’ `/mypage` ã«å¤‰æ›´

---

## ğŸ§© ãƒ¦ãƒ¼ã‚¶ãƒ¼ä½“é¨“

1. ãƒ¦ãƒ¼ã‚¶ãƒ¼ãŒSidebarã®ã€Œãƒã‚¤ãƒšãƒ¼ã‚¸ã€ã‚’ã‚¯ãƒªãƒƒã‚¯
2. `/mypage` ã«é·ç§»
3. ãƒšãƒ¼ã‚¸ä¸Šéƒ¨ã«ãƒ—ãƒ­ãƒ•ã‚£ãƒ¼ãƒ«ã¸ã®ãƒªãƒ³ã‚¯ãŒè¡¨ç¤ºã•ã‚Œã‚‹
4. ãƒ–ãƒƒã‚¯ãƒãƒ¼ã‚¯ä¸€è¦§ãŒãƒªã‚¹ãƒˆå½¢å¼ã§è¡¨ç¤ºã•ã‚Œã‚‹
   - ã‚µãƒ ãƒã‚¤ãƒ«ã€ã‚¿ã‚¤ãƒˆãƒ«ã€ãƒ¬ãƒƒã‚¹ãƒ³åã€æ¨å®šæ™‚é–“
5. è¨˜äº‹ã‚’ã‚¯ãƒªãƒƒã‚¯ã™ã‚‹ã¨è©³ç´°ãƒšãƒ¼ã‚¸ã«é·ç§»
6. ãƒ–ãƒƒã‚¯ãƒãƒ¼ã‚¯ãŒãªã„å ´åˆã¯ã€Œãƒ–ãƒƒã‚¯ãƒãƒ¼ã‚¯ãŒã‚ã‚Šã¾ã›ã‚“ã€ã¨è¡¨ç¤º

---

## ğŸ“ ã‚¹ãƒ†ãƒƒãƒ—ãƒã‚¤ã‚¹ãƒ†ãƒƒãƒ—å®Ÿè£…æ‰‹é †

### ã‚¹ãƒ†ãƒƒãƒ—1: Sidebarã®æ›´æ–°

**ãƒ•ã‚¡ã‚¤ãƒ«**: `src/components/layout/Sidebar/index.tsx`

**å¤‰æ›´ç®‡æ‰€**: 54-65è¡Œç›®

```typescript
// å¤‰æ›´å‰
<SidebarMenuItem
  href={user ? "/profile" : "/auth"}
  icon={...}
  isActive={isActive(user ? "/profile" : "/auth")}
>
  {user ? "ãƒã‚¤ãƒšãƒ¼ã‚¸" : "ãƒ­ã‚°ã‚¤ãƒ³"}
</SidebarMenuItem>

// å¤‰æ›´å¾Œ
<SidebarMenuItem
  href={user ? "/mypage" : "/auth"}
  icon={...}
  isActive={isActive(user ? "/mypage" : "/auth")}
>
  {user ? "ãƒã‚¤ãƒšãƒ¼ã‚¸" : "ãƒ­ã‚°ã‚¤ãƒ³"}
</SidebarMenuItem>
```

---

### ã‚¹ãƒ†ãƒƒãƒ—2: ãƒ–ãƒƒã‚¯ãƒãƒ¼ã‚¯è¨˜äº‹æƒ…å ±å–å¾—ã‚µãƒ¼ãƒ“ã‚¹ã®ä½œæˆ

**ãƒ•ã‚¡ã‚¤ãƒ«**: `src/services/bookmarks.ts`ï¼ˆæ—¢å­˜ãƒ•ã‚¡ã‚¤ãƒ«ã«è¿½åŠ ï¼‰

```typescript
import { client } from "@/lib/sanity";
import type { Article } from "@/types/sanity";

/**
 * ãƒ–ãƒƒã‚¯ãƒãƒ¼ã‚¯ã—ãŸè¨˜äº‹ã®è©³ç´°æƒ…å ±ã‚’å–å¾—
 * @returns ãƒ–ãƒƒã‚¯ãƒãƒ¼ã‚¯æ¸ˆã¿è¨˜äº‹ã®é…åˆ—ï¼ˆSanityã‹ã‚‰å–å¾—ï¼‰
 */
export async function getBookmarkedArticles(): Promise<Article[]> {
  try {
    // 1. Supabaseã‹ã‚‰ãƒ–ãƒƒã‚¯ãƒãƒ¼ã‚¯ã—ãŸè¨˜äº‹IDã‚’å–å¾—
    const bookmarkIds = await getBookmarks();

    if (bookmarkIds.length === 0) {
      return [];
    }

    // 2. Sanityã‹ã‚‰Articleæƒ…å ±ã‚’å–å¾—
    const query = `*[_type == "article" && _id in $ids] {
      _id,
      title,
      slug,
      thumbnail,
      coverImage,
      videoDuration,
      "lessonTitle": *[_type == "lesson" && references(^._id)][0].title,
      "lessonSlug": *[_type == "lesson" && references(^._id)][0].slug.current
    } | order(_createdAt desc)`;

    const articles = await client.fetch(query, { ids: bookmarkIds });
    return articles;
  } catch (error) {
    console.error('Get bookmarked articles error:', error);
    return [];
  }
}
```

---

### ã‚¹ãƒ†ãƒƒãƒ—3: ãƒ–ãƒƒã‚¯ãƒãƒ¼ã‚¯ãƒªã‚¹ãƒˆã‚¢ã‚¤ãƒ†ãƒ ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆ

**ãƒ•ã‚¡ã‚¤ãƒ«**: `src/components/mypage/BookmarkListItem.tsx`ï¼ˆæ–°è¦ä½œæˆï¼‰

```typescript
import { Link } from "react-router-dom";
import { Clock } from "lucide-react";
import { urlFor } from "@/lib/sanity";
import type { Article } from "@/types/sanity";

interface BookmarkListItemProps {
  article: Article & {
    lessonTitle?: string;
    lessonSlug?: string;
  };
}

/**
 * ãƒ–ãƒƒã‚¯ãƒãƒ¼ã‚¯ãƒªã‚¹ãƒˆã‚¢ã‚¤ãƒ†ãƒ 
 * ãƒªã‚¹ãƒˆå½¢å¼ã®1è¡Œã‚’è¡¨ç¤º
 */
export default function BookmarkListItem({ article }: BookmarkListItemProps) {
  const thumbnailUrl = article.thumbnail
    ? urlFor(article.thumbnail).width(160).height(90).url()
    : article.coverImage
    ? urlFor(article.coverImage).width(160).height(90).url()
    : "/placeholder-thumbnail.png";

  const durationMinutes = article.videoDuration
    ? Math.ceil(article.videoDuration / 60)
    : null;

  return (
    <Link
      to={`/articles/${article.slug.current}`}
      className="flex gap-4 p-4 rounded-lg hover:bg-gray-50 transition-colors border border-gray-100"
    >
      {/* ã‚µãƒ ãƒã‚¤ãƒ« */}
      <div className="flex-shrink-0 w-40 h-[90px] bg-gray-200 rounded overflow-hidden">
        <img
          src={thumbnailUrl}
          alt={article.title}
          className="w-full h-full object-cover"
        />
      </div>

      {/* ãƒ†ã‚­ã‚¹ãƒˆæƒ…å ± */}
      <div className="flex-1 min-w-0">
        {/* ãƒ¬ãƒƒã‚¹ãƒ³å */}
        {article.lessonTitle && (
          <p className="text-sm text-gray-600 mb-1">
            {article.lessonTitle}
          </p>
        )}

        {/* ã‚¿ã‚¤ãƒˆãƒ« */}
        <h3 className="text-lg font-bold text-gray-900 mb-2 line-clamp-2">
          {article.title}
        </h3>

        {/* æ¨å®šæ™‚é–“ */}
        {durationMinutes && (
          <div className="flex items-center gap-1 text-sm text-gray-500">
            <Clock className="w-4 h-4" />
            <span>{durationMinutes}åˆ†</span>
          </div>
        )}
      </div>
    </Link>
  );
}
```

---

### ã‚¹ãƒ†ãƒƒãƒ—4: ãƒã‚¤ãƒšãƒ¼ã‚¸ã®ä½œæˆ

**ãƒ•ã‚¡ã‚¤ãƒ«**: `src/pages/MyPage.tsx`ï¼ˆæ–°è¦ä½œæˆï¼‰

```typescript
import { useEffect, useState } from "react";
import { Link, useNavigate } from "react-router-dom";
import { useAuth } from "@/contexts/AuthContext";
import Layout from "@/components/layout/Layout";
import BookmarkListItem from "@/components/mypage/BookmarkListItem";
import { getBookmarkedArticles } from "@/services/bookmarks";
import type { Article } from "@/types/sanity";
import { User } from "lucide-react";

export default function MyPage() {
  const { user } = useAuth();
  const navigate = useNavigate();
  const [bookmarks, setBookmarks] = useState<Article[]>([]);
  const [loading, setLoading] = useState(true);

  useEffect(() => {
    // ãƒ­ã‚°ã‚¤ãƒ³ãƒã‚§ãƒƒã‚¯
    if (!user) {
      navigate("/auth");
      return;
    }

    // ãƒ–ãƒƒã‚¯ãƒãƒ¼ã‚¯ä¸€è¦§ã‚’å–å¾—
    const fetchBookmarks = async () => {
      setLoading(true);
      const articles = await getBookmarkedArticles();
      setBookmarks(articles);
      setLoading(false);
    };

    fetchBookmarks();
  }, [user, navigate]);

  if (loading) {
    return (
      <Layout>
        <div className="container mx-auto px-4 py-8">
          <p>èª­ã¿è¾¼ã¿ä¸­...</p>
        </div>
      </Layout>
    );
  }

  return (
    <Layout>
      <div className="container mx-auto px-4 py-8 max-w-4xl">
        {/* ãƒ˜ãƒƒãƒ€ãƒ¼ */}
        <div className="mb-8">
          <div className="flex items-center justify-between mb-4">
            <h1 className="text-3xl font-bold">ãƒã‚¤ãƒšãƒ¼ã‚¸</h1>
            <Link
              to="/profile"
              className="flex items-center gap-2 px-4 py-2 rounded-lg bg-gray-100 hover:bg-gray-200 transition-colors"
            >
              <User className="w-5 h-5" />
              <span>ãƒ—ãƒ­ãƒ•ã‚£ãƒ¼ãƒ«</span>
            </Link>
          </div>
          <p className="text-gray-600">
            ãƒ–ãƒƒã‚¯ãƒãƒ¼ã‚¯ã—ãŸè¨˜äº‹ã‚’ç¢ºèªã§ãã¾ã™
          </p>
        </div>

        {/* ãƒ–ãƒƒã‚¯ãƒãƒ¼ã‚¯ä¸€è¦§ */}
        <div>
          <h2 className="text-2xl font-bold mb-4">
            ãƒ–ãƒƒã‚¯ãƒãƒ¼ã‚¯ï¼ˆ{bookmarks.length}ä»¶ï¼‰
          </h2>

          {bookmarks.length === 0 ? (
            <div className="text-center py-12 bg-gray-50 rounded-lg">
              <p className="text-gray-600 mb-4">
                ãƒ–ãƒƒã‚¯ãƒãƒ¼ã‚¯ã—ãŸè¨˜äº‹ãŒã‚ã‚Šã¾ã›ã‚“
              </p>
              <Link
                to="/lessons"
                className="text-blue-600 hover:underline"
              >
                ãƒ¬ãƒƒã‚¹ãƒ³ã‚’è¦‹ã‚‹
              </Link>
            </div>
          ) : (
            <div className="space-y-3">
              {bookmarks.map((article) => (
                <BookmarkListItem key={article._id} article={article} />
              ))}
            </div>
          )}
        </div>
      </div>
    </Layout>
  );
}
```

---

### ã‚¹ãƒ†ãƒƒãƒ—5: ãƒ«ãƒ¼ãƒ†ã‚£ãƒ³ã‚°ã®è¿½åŠ 

**ãƒ•ã‚¡ã‚¤ãƒ«**: `src/App.tsx` ã¾ãŸã¯ ãƒ«ãƒ¼ãƒ†ã‚£ãƒ³ã‚°è¨­å®šãƒ•ã‚¡ã‚¤ãƒ«

```typescript
import MyPage from "@/pages/MyPage";

// ãƒ«ãƒ¼ãƒˆå®šç¾©ã«è¿½åŠ 
<Route path="/mypage" element={<MyPage />} />
```

---

## âœ… å®Œäº†ãƒã‚§ãƒƒã‚¯ãƒªã‚¹ãƒˆ

- [ ] Sidebarã®ã€Œãƒã‚¤ãƒšãƒ¼ã‚¸ã€ãƒªãƒ³ã‚¯ã‚’ `/mypage` ã«å¤‰æ›´
- [ ] `getBookmarkedArticles()` é–¢æ•°ã‚’å®Ÿè£…
- [ ] `BookmarkListItem` ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã‚’ä½œæˆ
- [ ] `MyPage` ãƒšãƒ¼ã‚¸ã‚’ä½œæˆ
- [ ] ãƒ«ãƒ¼ãƒ†ã‚£ãƒ³ã‚°ã‚’è¿½åŠ 
- [ ] æ‰‹å‹•ãƒ†ã‚¹ãƒˆã‚’å®Ÿæ–½:
  - [ ] ãƒ–ãƒƒã‚¯ãƒãƒ¼ã‚¯ãŒãªã„çŠ¶æ…‹ã§è¡¨ç¤ºç¢ºèª
  - [ ] ãƒ–ãƒƒã‚¯ãƒãƒ¼ã‚¯ã‚’è¿½åŠ ã—ã¦ä¸€è¦§ã«è¡¨ç¤ºã•ã‚Œã‚‹ã“ã¨ã‚’ç¢ºèª
  - [ ] è¨˜äº‹ã‚’ã‚¯ãƒªãƒƒã‚¯ã—ã¦è©³ç´°ãƒšãƒ¼ã‚¸ã«é·ç§»ã§ãã‚‹ã“ã¨ã‚’ç¢ºèª
  - [ ] ãƒ—ãƒ­ãƒ•ã‚£ãƒ¼ãƒ«ãƒªãƒ³ã‚¯ãŒå‹•ä½œã™ã‚‹ã“ã¨ã‚’ç¢ºèª
- [ ] ã‚³ãƒŸãƒƒãƒˆ

---

## ğŸ¨ ãƒ‡ã‚¶ã‚¤ãƒ³ä»•æ§˜

### ãƒ–ãƒƒã‚¯ãƒãƒ¼ã‚¯ãƒªã‚¹ãƒˆã‚¢ã‚¤ãƒ†ãƒ 

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”  ãƒ¬ãƒƒã‚¹ãƒ³ã‚¿ã‚¤ãƒˆãƒ«                        â”‚
â”‚ â”‚ ã‚µãƒ  â”‚  è¨˜äº‹ã‚¿ã‚¤ãƒˆãƒ«ï¼ˆ1-2è¡Œï¼‰                    â”‚
â”‚ â”‚ãƒã‚¤ãƒ«â”‚  â± 10åˆ†                                  â”‚
â”‚ â””â”€â”€â”€â”€â”€â”€â”˜                                           â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

- **ã‚µãƒ ãƒã‚¤ãƒ«**: 160px Ã— 90pxï¼ˆ16:9ï¼‰
- **ãƒ¬ãƒƒã‚¹ãƒ³å**: 14pxã€ã‚°ãƒ¬ãƒ¼
- **è¨˜äº‹ã‚¿ã‚¤ãƒˆãƒ«**: 18pxã€Boldã€æœ€å¤§2è¡Œ
- **æ¨å®šæ™‚é–“**: 14pxã€ã‚°ãƒ¬ãƒ¼ã€æ™‚è¨ˆã‚¢ã‚¤ã‚³ãƒ³ä»˜ã
- **ãƒ›ãƒãƒ¼åŠ¹æœ**: èƒŒæ™¯è‰²ã‚’ãƒ©ã‚¤ãƒˆã‚°ãƒ¬ãƒ¼ã«å¤‰æ›´

---

## ğŸ”§ å®Ÿè£…ã®ãƒã‚¤ãƒ³ãƒˆ

### 1. Sanityã‚¯ã‚¨ãƒªã§ã®ãƒ¬ãƒƒã‚¹ãƒ³æƒ…å ±å–å¾—

```groq
*[_type == "lesson" && references(^._id)][0].title
```

ã“ã®ã‚¯ã‚¨ãƒªã§è¨˜äº‹ãŒæ‰€å±ã™ã‚‹ãƒ¬ãƒƒã‚¹ãƒ³ã®æƒ…å ±ã‚’å–å¾—ã§ãã¾ã™ã€‚

### 2. ã‚µãƒ ãƒã‚¤ãƒ«ç”»åƒã®ãƒ•ã‚©ãƒ¼ãƒ«ãƒãƒƒã‚¯

```typescript
const thumbnailUrl = article.thumbnail
  ? urlFor(article.thumbnail).width(160).height(90).url()
  : article.coverImage
  ? urlFor(article.coverImage).width(160).height(90).url()
  : "/placeholder-thumbnail.png";
```

thumbnail â†’ coverImage â†’ placeholder ã®é †ã§è¡¨ç¤ºã—ã¾ã™ã€‚

### 3. æ¨å®šæ™‚é–“ã®è¨ˆç®—

`videoDuration` ã¯ç§’å˜ä½ãªã®ã§ã€åˆ†ã«å¤‰æ›ã—ã¦è¡¨ç¤ºã—ã¾ã™ã€‚

```typescript
const durationMinutes = article.videoDuration
  ? Math.ceil(article.videoDuration / 60)
  : null;
```

---

## ğŸ“š å‚è€ƒæƒ…å ±

### Sanity References Query
- [GROQ References](https://www.sanity.io/docs/groq-functions#references-6c3e46b7faa5)

### React Router Protected Routes
- [Protected Routes Pattern](https://reactrouter.com/en/main/start/tutorial#protected-routes)

---

## ğŸ‰ ãƒ•ã‚§ãƒ¼ã‚º3å®Œäº†å¾Œã®çŠ¶æ…‹

- âœ… ãƒã‚¤ãƒšãƒ¼ã‚¸ (`/mypage`) ãŒå®Ÿè£…ã•ã‚ŒãŸ
- âœ… ãƒ–ãƒƒã‚¯ãƒãƒ¼ã‚¯ä¸€è¦§ãŒè¡¨ç¤ºã•ã‚Œã‚‹
- âœ… ãƒ—ãƒ­ãƒ•ã‚£ãƒ¼ãƒ«ã¸ã®ãƒªãƒ³ã‚¯ãŒè¿½åŠ ã•ã‚ŒãŸ
- âœ… Sidebarã‹ã‚‰ `/mypage` ã«ã‚¢ã‚¯ã‚»ã‚¹ã§ãã‚‹
- â³ è¨˜äº‹ã®å®Œäº†æ©Ÿèƒ½ï¼ˆãƒ•ã‚§ãƒ¼ã‚º4ã§å®Ÿè£…ï¼‰
- â³ ãƒ¬ãƒƒã‚¹ãƒ³é€²æ—è¡¨ç¤ºï¼ˆãƒ•ã‚§ãƒ¼ã‚º5ã§å®Ÿè£…ï¼‰

**æ¬¡ã®ã‚¹ãƒ†ãƒƒãƒ—**: ãƒ•ã‚§ãƒ¼ã‚º4ã®è¨˜äº‹é€²æ—ç®¡ç†ï¼ˆå®Œäº†ãƒœã‚¿ãƒ³ï¼‰ã«é€²ã¿ã¾ã™ï¼
