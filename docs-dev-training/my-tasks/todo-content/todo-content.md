# 実装仕様書 - index.md・content.md 表示機能強化

## 🎯 実装目標

index.md と content.md の表示機能を段階的に強化し、Markdown の表現力を向上させる

## 📋 実装対象

それぞれの変更内容は Phase1~3 に分けて詳細を記します

### **変更 1: index.md 表示強化**

- YAML frontmatter データの表示
- Markdown 本文コンテンツの表示
- 各種 Markdown 要素への仮スタイル適用

### **変更 2: content.md 表示強化**

- より多くの見出しレベル（###, ####等）対応
- 引用、画像、リンクの適切な表示
- `<!-- PREMIUM_ONLY -->`マーカーの非表示化
- 表示エラーの防止

### **変更 3: デザイン解答例特別スタイル**

- カスタムマーカー方式での特別セクション認識
- 専用スタイルの適用

## 🏗️ 実装フェーズ構成

| フェーズ    | 目的                       | 推定時間   | 成果物                       |
| ----------- | -------------------------- | ---------- | ---------------------------- |
| **Phase 1** | index.md 表示強化          | 1 時間     | YAML 表示＋本文表示機能      |
| **Phase 2** | content.md 表示強化        | 1-2 時間   | 拡張された Markdown 表示機能 |
| **Phase 3** | デザイン解答例特別スタイル | 0.5-1 時間 | カスタムセクション表示機能   |

## 🎨 スタイル方針

- **/training 以下の既存スタイル**を基準として統一
- **Tailwind CSS**で仮スタイルを設定
- **後から変更容易**な構造で実装

## 🔄 テスト戦略

各フェーズ完了時に以下を確認：

- 既存機能の動作継続
- 新機能の正常動作
- スタイルの適切な適用
- エラーハンドリングの動作

---

# Phase 1: index.md 表示強化 実装仕様

## 🎯 Phase 1 目標

index.md の YAML メタデータと本文コンテンツを表示する機能を追加

## 📋 実装対象（変更 1 の要件）

### **実装内容**:

- ✅ index.md の YAML 以下の Markdown を表示する
- ✅ 見出しごとにスタイルを当てる（## / ### / #### など）
- ✅ 引用 > hogehoge
- ✅ 画像 マークダウンのイメージ表記
- ✅ リンク マークダウンのリンク表記
- ✅ YAML のデータを表示する（difficulty を除く）

## 📋 実装ステップ

### **Step 1-1: YamlMetaDisplay.tsx コンポーネント作成**

**実装内容**:

- YAML frontmatter データを受け取る Props 定義
- 各メタデータ項目の表示コンポーネント
- **difficulty フィールドを除く**全項目表示
- /training 既存スタイルとの統一

**表示対象項目**:

- title（タイトル）
- description（説明）
- type（challenge/skill）
- tags（タグ配列）
- estimated_total_time（推定時間）
- task_count（タスク数）
- category（カテゴリ）※新規追加予定
- thumbnailImage（サムネイル）※新規追加予定

### **Step 1-2: TrainingDetail.tsx 拡張**

**実装内容**:

- index.md の本文コンテンツ取得機能追加
- YamlMetaDisplay コンポーネントの組み込み
- MarkdownRenderer による本文表示
- 既存レイアウトとの調和

**レイアウト構成**:

1. 既存のヘッダー部分（タイトル、説明等）
2. **新規**: YAML メタデータ表示セクション
3. **新規**: index.md 本文コンテンツ表示セクション
4. 既存のタスク一覧セクション

### **Step 1-3: index.md 用 Markdown コンポーネント設定**

**実装内容**:

- ReactMarkdown の`components`プロパティを設定
- 見出し（h2, h3, h4）のカスタムコンポーネント設定
- 引用（blockquote）のカスタムスタイル設定
- 画像（img）の表示設定とスタイル
- リンク（a）のスタイルと動作設定

**スタイル方針**:

- /training 既存スタイルと統一
- Tailwind クラスで仮スタイル設定
- 後からカスタマイズ可能な構造

### **Step 1-4: データ取得ロジック拡張**

**実装内容**:

- index.md の本文コンテンツ取得
- frontmatter と content 部分の分離
- エラーハンドリング（本文がない場合の対応）
- キャッシュ対応（既存システムとの統合）

### **Step 1-5: 型定義拡張**

**実装内容**:

- TrainingDetailData 型に content 属性追加
- YamlMetaDisplay 用の型定義追加
- 既存型との互換性維持

## 🎨 スタイル定義

### **見出しスタイル階層**

- **h2**: メインセクション見出し（大きめ、濃いテキスト）
- **h3**: サブセクション見出し（中サイズ）
- **h4**: 詳細セクション見出し（小さめ）

### **その他要素スタイル**

- **引用**: 左ボーダー + 背景色 + イタリック
- **画像**: 角丸 + シャドウ + レスポンシブ
- **リンク**: ブルー系色 + ホバー効果 + 外部リンク対応

### **YamlMetaDisplay 配置**

- カード形式での表示
- グリッドレイアウトでの項目配置
- 既存デザインシステムとの統一

## ✅ 完了条件

1. TrainingDetail ページで index.md の本文が表示される
2. YAML メタデータが整理されて表示される
3. **difficulty が表示されない**
4. 見出し（## / ### / ####）が適切なスタイルで表示される
5. 引用、画像、リンクが正しくスタイル付きで表示される
6. 既存のレイアウトが崩れない
7. データ取得エラー時も安全に動作する

## 🧪 テスト項目

- [ ] index.md 本文の表示確認
- [ ] YAML メタデータの表示確認
- [ ] **difficulty の非表示確認**
- [ ] 各見出しレベルの表示確認
- [ ] 引用ブロックの表示確認
- [ ] 画像の表示とレスポンシブ確認
- [ ] 外部リンクの動作確認
- [ ] レスポンシブレイアウト確認
- [ ] データ取得エラー時の動作確認
- [ ] 既存機能（タスク一覧等）の動作継続確認

---

# Phase 2: content.md 表示強化 実装仕様

## 🎯 Phase 2 目標

content.md の表示機能を強化し、より多くの Markdown 要素に対応する

## 📋 実装対象（変更 2 の要件）

### **その１：マークダウンの内容**

- ✅ ## だけでなく ### / #### の見出しなどを表示できるようにする
- ✅ 引用 > hogehoge
- ✅ 画像 マークダウンのイメージ表記
- ✅ リンク マークダウンのリンク表記
- ✅ 表示してない情報があった場合はエラーなく、シンプルに表示がされない設定にする

### **その２：マークダウン内容について**

- ✅ `<!-- PREMIUM_ONLY -->`のような有料・無料区別マーカーは区別に必要だが、ページに文字列として表示されないようにする
- ✅ 表示を整える

## 📋 実装ステップ

### **Step 2-1: MarkdownRenderer.tsx 拡張**

**実装内容**:

- ReactMarkdown の`components`プロパティを拡張
- 見出しレベル（h3, h4, h5, h6）の追加対応
- 引用、画像、リンクのスタイル改善
- /training 既存スタイルとの統一

**新規対応要素**:
※具体例の参考として扱ってください。既存の仕組みを重視してください

```typescript
const markdownComponents = {
  // 見出し拡張（### / #### 対応）
  h3: ({ children }: any) => (
    <h3 className="text-xl font-semibold text-slate-800 mb-3 mt-5">
      {children}
    </h3>
  ),
  h4: ({ children }: any) => (
    <h4 className="text-lg font-medium text-slate-700 mb-2 mt-4">{children}</h4>
  ),
  h5: ({ children }: any) => (
    <h5 className="text-base font-medium text-slate-600 mb-2 mt-3">
      {children}
    </h5>
  ),
  h6: ({ children }: any) => (
    <h6 className="text-sm font-medium text-slate-500 mb-1 mt-2">{children}</h6>
  ),

  // 引用
  blockquote: ({ children }: any) => (
    <blockquote className="border-l-4 border-blue-200 bg-blue-50 p-4 my-4 italic text-slate-700">
      {children}
    </blockquote>
  ),

  // 画像
  img: ({ src, alt }: any) => (
    <img
      src={src}
      alt={alt}
      className="max-w-full h-auto rounded-lg shadow-md my-4"
    />
  ),

  // リンク
  a: ({ href, children }: any) => (
    <a
      href={href}
      className="text-blue-600 hover:text-blue-800 underline"
      target="_blank"
      rel="noopener noreferrer"
    >
      {children}
    </a>
  ),
};
```

### **Step 2-2: HTML コメントマーカー非表示化**

**実装内容**:

- ✅ `<!-- PREMIUM_ONLY -->`のような有料・無料区別マーカーは区別に必要だが、ページに文字列として表示されないようにする

### **Step 2-3: エラーハンドリング強化**

**実装内容**:

- 不正な Markdown 要素の安全な処理
- 画像読み込み失敗時のフォールバック
- リンク先検証エラーの無視
- 表示エラー時のグレースフル デグラデーション

**エラー対応仕様**:

- 表示できない要素は静かに無視
- エラーログは出力するが、ユーザーには表示しない
- 部分的な表示失敗でも全体は表示継続

### **Step 2-4: レンダリング順序最適化**

**実装内容**:

- HTML コメント削除 → プレミアム分割 → セクション解析 → レンダリング
- 既存の特別セクション（学習のゴール等）との競合回避
- パフォーマンス最適化

## 🎨 スタイル定義

### **見出しスタイル階層**

- **h2**: メインセクション見出し（既存）
- **h3**: サブセクション見出し（新規対応）
- **h4**: 詳細セクション見出し（新規対応）
- **h5**: 細分化見出し（新規対応）
- **h6**: 最小見出し（新規対応）

### **要素スタイル改善**

- **引用**: より目立つデザイン、可読性向上
- **画像**: レスポンシブ対応、ローディング最適化
- **リンク**: 外部リンク識別、ホバー効果

## ✅ 完了条件

1. ### と #### 見出しが適切なスタイルで表示される
2. 引用、画像、リンクが正しくスタイル付きで表示される
3. **`<!-- PREMIUM_ONLY -->`が画面に表示されない**
4. **表示エラーが発生せず、不正な要素は安全に無視される**
5. 既存の特別セクション（学習のゴール等）が正常動作する
6. content.md のすべての Markdown 要素が適切に表示される

## 🧪 テスト項目

- [ ] ### / #### / ##### / ###### 見出しの表示確認
- [ ] 引用ブロックの表示確認
- [ ] 画像の表示とレスポンシブ確認
- [ ] 外部リンクの動作確認
- [ ] **プレミアムマーカーの非表示確認**
- [ ] **不正な Markdown 要素でのエラー非発生確認**
- [ ] 既存セクションの動作継続確認
- [ ] パフォーマンスの確認

## 🔧 技術実装詳細

### **マーカー削除処理順序**

1. HTML コメント全般の削除
2. プレミアムマーカーの特別処理
3. 区切り線の整理
4. 空白行の正規化

### **エラーハンドリング戦略**

- try-catch でのラップ
- console.warn でのログ出力（本番では無効化）
- フォールバック表示の実装
- 部分的失敗での継続処理

### **既存機能との統合**

- 既存の parseSection 機能との併用
- removeSections 処理との順序調整
- 特別コンポーネントとの協調動作

---

# Phase 3: デザイン解答例特別スタイル 実装仕様

## 📋 実装対象（変更 3 の要件）

### **デザイン解答例セクション**

- ✅ カスタムマーカー方式での特別セクション認識
- ✅ 専用スタイルの適用
- ✅ 最もシンプルな方法での実装
- ✅ markdown で入力したものを表示するという仕組みは維持
- ✅ 多少 HTML が入るのは OK（ただし全ての書き方を変える必要はなし）

**対象セクション例**:

```markdown
## デザイン解答例

BONO でお題の解答例を公開しています

### 写真投稿 SNS のプロフィール UI のデザイン例

お題のデザインイメージを以下のページで解説しています。
BONO のコンテンツ閲覧するためのプラン加入が必要です。
解説と解答でデザインしながらレベルアップしましょう
□ 動画ページのタイトル
https://bo-no.design
```

## 📋 実装ステップ

### **Step 3-1: カスタムマーカー解析機能追加**

**対象ファイル**: `src/components/training/MarkdownRenderer.tsx`

**実装内容**:

- カスタムマーカーのパースロジック追加
- マーカー範囲内コンテンツの抽出
- 既存のセクション解析機能との統合

**マーカー仕様**:

```markdown
<!-- DESIGN_ANSWER_SECTION -->

## デザイン解答例

BONO でお題の解答例を公開しています

### 写真投稿 SNS のプロフィール UI のデザイン例

お題のデザインイメージを以下のページで解説しています。
BONO のコンテンツ閲覧するためのプラン加入が必要です。
解説と解答でデザインしながらレベルアップしましょう
□ 動画ページのタイトル
https://bo-no.design

<!-- /DESIGN_ANSWER_SECTION -->
```

### **Step 3-2: DesignAnswerSection.tsx コンポーネント作成**

**新規ファイル**: `src/components/training/DesignAnswerSection.tsx`

**実装内容**:

- デザイン解答例専用のレイアウトコンポーネント
- 特別なスタイリング（背景、ボーダー、アイコン等）
- 内部の Markdown コンテンツのレンダリング
- /training 既存スタイルとの調和

**デザイン要件**:

- 他のセクションと明確に差別化
- 視覚的に「特別なコンテンツ」であることが分かる
- 読みやすさを保持

### **Step 3-3: マーカー処理ロジック統合**

**対象ファイル**: `src/components/training/MarkdownRenderer.tsx`

**実装内容**:

- `parseCustomSection`関数の追加
- カスタムマーカー範囲の除去処理
- DesignAnswerSection コンポーネントの配置
- 既存の処理フローとの統合

**処理フロー**:

1. カスタムマーカーの検出・抽出
2. 抽出したコンテンツを DesignAnswerSection に渡す
3. 元のコンテンツからマーカー範囲を除去
4. 通常の Markdown レンダリング継続

### **Step 3-4: エラーハンドリング・フォールバック**

**実装内容**:

- マーカーが不正な場合の安全な処理
- 開始・終了マーカーの不一致対応
- コンテンツが空の場合の処理
- 通常の Markdown セクションとしてのフォールバック

## 🎨 DesignAnswerSection スタイル仕様

### **視覚的差別化要素**

- 背景色またはボーダーでの区別
- 専用アイコンまたはラベル
- タイポグラフィの調整
- 余白・パディングの調整

### **内部コンテンツスタイル**

- 見出しスタイルの調整
- リンクスタイルの強調
- テキストの可読性向上
- レスポンシブ対応

## ✅ 完了条件

1. カスタムマーカーで囲まれたコンテンツが特別スタイルで表示される
2. マーカー自体は画面に表示されない
3. マーカー内の Markdown 要素（見出し、リンク等）が正しく処理される
4. マーカーがない場合も正常に動作する
5. 既存の特別セクション機能が影響を受けない
6. エラーハンドリングが適切に動作する

## 🧪 テスト項目

- [ ] デザイン解答例セクションの特別スタイル表示確認
- [ ] マーカーの非表示確認
- [ ] マーカー内 Markdown 要素の正常処理確認
- [ ] マーカーなしコンテンツの正常表示確認
- [ ] 不正なマーカーでのエラーハンドリング確認
- [ ] 既存機能の動作継続確認

## 🔧 技術実装詳細

### **マーカー検出正規表現**

```typescript
const customSectionRegex =
  /<!--\s*DESIGN_ANSWER_SECTION\s*-->([\s\S]*?)<!--\s*\/DESIGN_ANSWER_SECTION\s*-->/g;
```

### **処理順序**

1. プレミアムコンテンツ分割
2. カスタムマーカー検出・抽出
3. 既存特別セクション処理
4. 通常 Markdown レンダリング
5. カスタムセクション配置

### **拡張性考慮**

- 将来的な他のカスタムマーカー追加に対応
- マーカー種別の設定ファイル化可能な構造
- コンポーネントの再利用性確保
