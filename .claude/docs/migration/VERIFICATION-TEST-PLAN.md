# 移行後検証テスト計画

**作成日**: 2025-12-05
**目的**: 移行済みデータの動作確認

---

## 📊 現在の状況

### 移行完了済み（2025-11-19実行）

| テーブル | 件数 | 状態 |
|----------|------|------|
| auth.users | 2,045件 | ✅ 移行済み |
| stripe_customers | 2,042件 | ✅ 移行済み |
| user_subscriptions | 2,037件 | ✅ 移行済み |

### データ整合性（2025-12-05確認）

| チェック項目 | 結果 |
|--------------|------|
| 孤児レコード | ✅ 0件 |
| 重複レコード | ✅ 0件 |
| plan_members 修正 | ✅ 3件修正済み |

---

## 🎯 検証テスト計画

### Phase A: 運営アカウントテスト（あなた自身）

**目的**: 基本動作の確認

**対象**: 運営者の個人アカウント 1件

**テスト内容**:

| # | テスト項目 | 確認方法 | 期待結果 |
|---|------------|----------|----------|
| A-1 | ログイン | メール/パスワードでログイン | ✅ 成功 |
| A-2 | サブスク情報表示 | マイページ確認 | プラン名、期間、更新日が正しい |
| A-3 | メンバー限定コンテンツ | 限定ページにアクセス | ✅ 閲覧可能 |
| A-4 | サブスク管理 | Stripeポータル遷移 | ✅ 正常に遷移 |

**実施手順**:

1. 新サイトにアクセス
2. ログイン（パスワードリセット必要な場合あり）
3. マイページでサブスク情報を確認
4. メンバー限定コンテンツにアクセス
5. Stripeポータルに遷移できるか確認

---

### Phase B: メンバー10人テスト

**目的**: 複数ユーザーでの動作確認

**対象**: アクティブなメンバー 10人

**選定基準**:
- `is_active = true` のユーザー
- 連絡が取れるユーザー（テスト協力依頼可能）
- できれば異なるプラン（standard/feedback, 1ヶ月/3ヶ月）を含む

**テスト内容**:

| # | テスト項目 | 確認方法 | 期待結果 |
|---|------------|----------|----------|
| B-1 | ログイン | 各ユーザーがログイン | ✅ 成功 |
| B-2 | サブスク情報 | マイページ確認 | ✅ 正しく表示 |
| B-3 | コンテンツアクセス | 限定ページ確認 | ✅ 閲覧可能 |
| B-4 | 問題報告 | フィードバック収集 | 問題なし |

**実施手順**:

1. テスト対象ユーザーを選定
2. パスワードリセットメールを送信
3. テスト協力依頼（メールまたはSlack）
4. フィードバックを収集
5. 問題があれば修正

---

### Phase C: 追加テスト（必要に応じて）

**目的**: エッジケースの確認

**対象ケース**:

| ケース | テスト内容 |
|--------|------------|
| C-1 | 非アクティブユーザーのログイン |
| C-2 | サブスク更新（Webhook動作確認） |
| C-3 | サブスクキャンセル（Webhook動作確認） |
| C-4 | 新規登録→サブスク購入の流れ |

---

## 📋 チェックリスト

### Phase A: 運営アカウントテスト ✅ 完了（2025-12-05）

- [x] A-1: ログインできる
- [x] A-2: サブスク情報が正しく表示される
- [x] A-3: メンバー限定コンテンツにアクセスできる（CORS修正後）
- [x] A-4: Stripeポータルに遷移できる

**Phase A 完了条件**: 上記すべてクリア ✅

---

### Phase B: メンバー10人テスト

**テスト対象ユーザー**:

| # | メール | プラン | テスト結果 | 備考 |
|---|--------|--------|------------|------|
| 1 | (選定後記入) | | | |
| 2 | (選定後記入) | | | |
| 3 | (選定後記入) | | | |
| 4 | (選定後記入) | | | |
| 5 | (選定後記入) | | | |
| 6 | (選定後記入) | | | |
| 7 | (選定後記入) | | | |
| 8 | (選定後記入) | | | |
| 9 | (選定後記入) | | | |
| 10 | (選定後記入) | | | |

**Phase B 完了条件**: 10人中8人以上が問題なく利用できる

---

### Phase C: 追加テスト

- [ ] C-1: 非アクティブユーザーのログイン確認
- [ ] C-2: サブスク更新のWebhook動作確認
- [ ] C-3: サブスクキャンセルのWebhook動作確認
- [x] C-4: 新規登録→購入フロー確認 ✅ 完了（2025-12-05、kyasya00@gmail.com）

---

## 🔄 テスト実施フロー

```
Phase A: 運営アカウントテスト
    │
    ├── 成功 → Phase B へ
    │
    └── 失敗 → 問題を修正して再テスト

Phase B: メンバー10人テスト
    │
    ├── 8/10以上成功 → Phase C へ（必要なら）
    │
    └── 失敗多数 → 問題を分析・修正

Phase C: 追加テスト（オプション）
    │
    └── 完了 → 本番運用開始
```

---

## ⚠️ トラブル対応

### パスワードリセットが届かない

1. Supabase Dashboard → Authentication → Users
2. 対象ユーザーを検索
3. 「Send password recovery email」をクリック
4. 迷惑メールフォルダも確認依頼

### ログインできない

1. メールアドレスが正しいか確認
2. auth.users にユーザーが存在するか確認
3. email_confirmed_at が設定されているか確認

### サブスク情報が表示されない

1. user_subscriptions にレコードがあるか確認
2. is_active = true か確認
3. plan_members = true か確認

---

## 📝 次のアクション

1. **今すぐ**: Phase A（運営アカウントテスト）を実施
2. **Phase A 完了後**: テスト対象の10人を選定
3. **選定後**: パスワードリセットメール送信 & テスト依頼

---

## 関連ドキュメント

- [MIGRATION-PLAN.md](./MIGRATION-PLAN.md) - 移行計画
- [DATA-MAPPING.md](./DATA-MAPPING.md) - データマッピング
- [migration-test-guide.md](./migration-test-guide.md) - 旧テストガイド
