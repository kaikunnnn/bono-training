# 開発ワークフロー - ドキュメント管理ルール

**最終更新:** 2025-11-21 21:30 JST

---

## 🎯 基本方針

**体系的なテスト・デバッグアプローチを実施する**

---

## 📁 ドキュメント構成

### 🔴 最重要ドキュメント

**`SUBSCRIPTION-SYSTEM-SPECIFICATION.md`** - システム完全仕様書
- アーキテクチャ
- 実装済み機能詳細
- 技術仕様
- データベース設計
- セキュリティ

**`TESTING-LOG.md`** - テスト実施ログ
- テスト計画
- 実施手順
- 結果記録
- デバッグ用クエリ

---

### 📘 参考ドキュメント（読み取り専用）

- `subscription-user-flow-specification.md` - ユーザーフロー詳細
- `WORKFLOW.md` - このドキュメント

---

## 🔄 作業フロー

### パターン1: テスト実施

```
1️⃣ Claude: TESTING-LOG.mdにテスト計画を追加
   - テスト目的
   - 実施手順
   - 期待される結果
   - 記入項目
   ↓
2️⃣ ユーザー: テスト実施
   ↓
3️⃣ ユーザー: TESTING-LOG.mdに記入
   - Stripe決済結果
   - ブラウザの表示
   - Network Response
   ↓
4️⃣ ユーザー: 「記入完了」とClaudeに伝える
   ↓
5️⃣ Claude: 検証実施
   - Webhookログ確認
   - DB確認
   - 総合判定
   ↓
6️⃣ Claude: 結果をTESTING-LOG.mdに記録
   - ✅ 成功 / ❌ 失敗 / ⚠️ 部分成功
   - 問題点と対策
   - 次のアクション
```

---

### パターン2: バグ修正

```
1️⃣ 問題発見
   ↓
2️⃣ Claude: 詳細ログ追加で原因特定
   ↓
3️⃣ Claude: 修正実施
   ↓
4️⃣ Claude: デプロイ
   ↓
5️⃣ Claude: テスト計画をTESTING-LOG.mdに追加
   ↓
6️⃣ ユーザー: 動作確認・記入
   ↓
7️⃣ Claude: 検証・結果記録
```

---

## ✅ ルール

### やること
- ✅ TESTING-LOG.md に全テスト結果を記録
- ✅ テスト結果は完全にコピペ（省略禁止）
- ✅ エラーログは全文記録
- ✅ 時系列を保つ（テスト1, テスト2, ...）
- ✅ 仕様書（SUBSCRIPTION-SYSTEM-SPECIFICATION.md）を常に最新に保つ

### やらないこと
- ❌ テスト結果を要約・省略しない
- ❌ 重要な情報を削除しない
- ❌ ドキュメントを勝手に増やさない

---

## 📝 ユーザーの記入ルール

### テスト実施後に記入する項目

TESTING-LOG.mdの各テストセクションに以下を記入:

#### 1. Stripe決済結果
```
New/Old Subscription ID
金額
ステータス
```

#### 2. ブラウザの表示
```
現在のプラン
期間
次回更新日
バッジ（解約予定など）
```

#### 3. Network Response
```json
check-subscription のPOSTリクエストのResponse
```

### 記入完了後
「記入完了」とClaudeに伝える

---

## 🤖 Claudeの記入ルール

### 「記入完了」と言われたら実施

1️⃣ **TESTING-LOG.md を読む**
   - 最新テストセクション確認
   - ユーザー記入内容を把握

2️⃣ **Webhookログ確認**
   ```
   mcp__supabase__get_logs
   エラー有無確認
   ```

3️⃣ **DB確認**
   ```sql
   該当Stripe IDでクエリ
   データ保存状態を確認
   ```

4️⃣ **総合判定**
   - ✅ 完全成功
   - ⚠️ 部分成功
   - ❌ 失敗

5️⃣ **結果をTESTING-LOG.mdに記録**
   - 検証結果
   - 問題点
   - 次のアクション

6️⃣ **ユーザーに報告**
   - 結果サマリー
   - 次のテスト内容

---

## 📊 現在の状況確認方法

```
TESTING-LOG.mdを開く
  ↓
テスト状況サマリーを確認
  ↓
最新のテストセクションを見る
  ↓
次のテストを確認
```

---

## 🔍 トラブルシューティング

### システム仕様を確認
→ SUBSCRIPTION-SYSTEM-SPECIFICATION.md

### テスト結果を確認
→ TESTING-LOG.md

### ワークフローを確認
→ WORKFLOW.md（このドキュメント）

---

## 📌 現在のタスク

**TESTING-LOG.mdのテスト状況サマリーを参照**

---

## 🚨 重要な約束

### Claudeは必ず守る
1. テスト計画は必ずTESTING-LOG.mdに記載してから実施依頼
2. 検証結果は必ずTESTING-LOG.mdに記録
3. システム仕様変更時はSUBSCRIPTION-SYSTEM-SPECIFICATION.mdを更新

### ユーザーは必ず守る
1. テスト結果は必ずTESTING-LOG.mdに記入
2. 記入完了したらClaudeに伝える
3. 次のテストはTESTING-LOG.mdで確認

---

**このワークフローで、体系的なテスト・開発を進められます。**
