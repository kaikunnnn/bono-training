# ãƒ¡ãƒ¼ãƒ«æ©Ÿèƒ½ ä»•æ§˜æ›¸

**ä½œæˆæ—¥**: 2025-01-20
**ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹**: å®Ÿè£…æº–å‚™ä¸­

---

## æ¦‚è¦

ãƒ¦ãƒ¼ã‚¶ãƒ¼ã¸ã®ãƒˆãƒ©ãƒ³ã‚¶ã‚¯ã‚·ãƒ§ãƒ³ãƒ¡ãƒ¼ãƒ«é€ä¿¡æ©Ÿèƒ½ã€‚Resendã‚’ä½¿ç”¨ã€‚

## æƒ³å®šãƒ¡ãƒ¼ãƒ«é‡

- æœˆé–“ç´„100é€šï¼ˆç™»éŒ²ãƒ»è§£ç´„ãƒ»ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ãƒªã‚»ãƒƒãƒˆç­‰ï¼‰
- Resendç„¡æ–™æ ï¼ˆ3,000é€š/æœˆï¼‰ã§ååˆ†å¯¾å¿œå¯èƒ½

---

## ãƒ¡ãƒ¼ãƒ«ã®ç¨®é¡

### Phase 1: Supabase Auth ãƒ¡ãƒ¼ãƒ«ï¼ˆSMTPè¨­å®šï¼‰

| ãƒ¡ãƒ¼ãƒ«ç¨®åˆ¥ | ãƒˆãƒªã‚¬ãƒ¼ | å„ªå…ˆåº¦ |
|-----------|---------|--------|
| ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ãƒªã‚»ãƒƒãƒˆ | ãƒ¦ãƒ¼ã‚¶ãƒ¼ãŒãƒªã‚»ãƒƒãƒˆè¦æ±‚ | ğŸ”´ å¿…é ˆ |
| ãƒ¡ãƒ¼ãƒ«ã‚¢ãƒ‰ãƒ¬ã‚¹ç¢ºèª | æ–°è¦ç™»éŒ²æ™‚ | ğŸ”´ å¿…é ˆ |
| ãƒ¡ãƒ¼ãƒ«ã‚¢ãƒ‰ãƒ¬ã‚¹å¤‰æ›´ç¢ºèª | ãƒ¡ãƒ¼ãƒ«å¤‰æ›´æ™‚ | ğŸŸ¡ ä¸­ |

### Phase 2: ã‚«ã‚¹ã‚¿ãƒ ãƒˆãƒ©ãƒ³ã‚¶ã‚¯ã‚·ãƒ§ãƒ³ãƒ¡ãƒ¼ãƒ«

| ãƒ¡ãƒ¼ãƒ«ç¨®åˆ¥ | ãƒˆãƒªã‚¬ãƒ¼ | å„ªå…ˆåº¦ |
|-----------|---------|--------|
| ã‚¦ã‚§ãƒ«ã‚«ãƒ ãƒ¡ãƒ¼ãƒ« | æ–°è¦ç™»éŒ²å®Œäº† | ğŸŸ¡ ä¸­ |
| ã‚µãƒ–ã‚¹ã‚¯é–‹å§‹é€šçŸ¥ | Stripe checkoutæˆåŠŸ | ğŸŸ¡ ä¸­ |
| ã‚µãƒ–ã‚¹ã‚¯è§£ç´„é€šçŸ¥ | Stripe subscription canceled | ğŸŸ¡ ä¸­ |
| ãƒ—ãƒ©ãƒ³å¤‰æ›´é€šçŸ¥ | Stripe subscription updated | ğŸŸ¢ ä½ |

---

## æŠ€è¡“æ§‹æˆ

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    Resend                           â”‚
â”‚              (ãƒ¡ãƒ¼ãƒ«é€ä¿¡ã‚µãƒ¼ãƒ“ã‚¹)                    â”‚
â”‚                                                     â”‚
â”‚  API Key: re_xxxxxxxxxx                            â”‚
â”‚  Domain: bono.design (è¦èªè¨¼)                       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
        â†‘                           â†‘
        â”‚ SMTP                      â”‚ API
        â”‚                           â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”         â”Œâ”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Supabase Auth  â”‚         â”‚ Edge Function  â”‚
â”‚                â”‚         â”‚ send-email     â”‚
â”‚ SMTPè¨­å®š:      â”‚         â”‚                â”‚
â”‚ Host: smtp.    â”‚         â”‚ POST /send-    â”‚
â”‚   resend.com   â”‚         â”‚   email        â”‚
â”‚ Port: 465      â”‚         â”‚                â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## å®Ÿè£…ã‚¹ãƒ†ãƒƒãƒ—

### âœ… Phase 0: æº–å‚™ï¼ˆ10åˆ†ï¼‰ã€å®Œäº†ã€‘

- [x] **0-1**: Resendã‚¢ã‚«ã‚¦ãƒ³ãƒˆä½œæˆ
  - https://resend.com ã§ã‚µã‚¤ãƒ³ã‚¢ãƒƒãƒ—
  - GitHubã‚¢ã‚«ã‚¦ãƒ³ãƒˆã§ãƒ­ã‚°ã‚¤ãƒ³å¯èƒ½

- [x] **0-2**: APIã‚­ãƒ¼å–å¾—
  - Dashboard â†’ API Keys â†’ Create API Key
  - åå‰: `bono-production`
  - Permission: `Full access`
  - **ã‚­ãƒ¼ã‚’å®‰å…¨ã«ä¿å­˜**ï¼ˆ1å›ã—ã‹è¡¨ç¤ºã•ã‚Œãªã„ï¼‰

---

### ğŸ”§ Phase 1: ãƒ‰ãƒ¡ã‚¤ãƒ³èªè¨¼ï¼ˆ15åˆ†ï¼‰

- [ ] **1-1**: Resendã§ãƒ‰ãƒ¡ã‚¤ãƒ³è¿½åŠ 
  - Dashboard â†’ Domains â†’ Add Domain
  - ãƒ‰ãƒ¡ã‚¤ãƒ³: `bono.design`ï¼ˆã¾ãŸã¯ä½¿ç”¨ã™ã‚‹ãƒ‰ãƒ¡ã‚¤ãƒ³ï¼‰

- [ ] **1-2**: DNSè¨­å®š
  ResendãŒè¡¨ç¤ºã™ã‚‹DNSãƒ¬ã‚³ãƒ¼ãƒ‰ã‚’è¿½åŠ :

  | Type | Name | Value |
  |------|------|-------|
  | MX | send | feedback-smtp.us-east-1.amazonses.com |
  | TXT | send | v=spf1 include:amazonses.com ~all |
  | TXT | resend._domainkey | (ResendãŒç”Ÿæˆ) |

- [ ] **1-3**: èªè¨¼ç¢ºèª
  - DNSä¼æ’­ã‚’å¾…ã¤ï¼ˆé€šå¸¸5åˆ†ã€œ24æ™‚é–“ï¼‰
  - Resendãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰ã§Verifiedè¡¨ç¤ºã‚’ç¢ºèª

---

### ğŸ”§ Phase 2: Supabase SMTPè¨­å®šï¼ˆ10åˆ†ï¼‰

- [ ] **2-1**: Supabaseç®¡ç†ç”»é¢ã§SMTPè¨­å®š
  - Project Settings â†’ Authentication â†’ SMTP Settings
  - Enable Custom SMTP: ON

  ```
  Host: smtp.resend.com
  Port: 465
  User: resend
  Password: [Resend APIã‚­ãƒ¼]
  Sender email: noreply@bono.design
  Sender name: ãƒœãƒ
  ```

- [ ] **2-2**: ãƒ†ã‚¹ãƒˆãƒ¡ãƒ¼ãƒ«é€ä¿¡
  - ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ãƒªã‚»ãƒƒãƒˆã‚’ãƒ†ã‚¹ãƒˆ
  - ãƒ¡ãƒ¼ãƒ«ãŒã€Œãƒœãƒã€ã‹ã‚‰å±Šãã“ã¨ã‚’ç¢ºèª

---

### ğŸ”§ Phase 3: ãƒ¡ãƒ¼ãƒ«ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆã‚«ã‚¹ã‚¿ãƒã‚¤ã‚ºï¼ˆ30åˆ†ï¼‰

- [ ] **3-1**: Supabaseãƒ¡ãƒ¼ãƒ«ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆç·¨é›†
  - Authentication â†’ Email Templates

  ç·¨é›†å¯¾è±¡:
  - Confirm signupï¼ˆç™»éŒ²ç¢ºèªï¼‰
  - Reset passwordï¼ˆãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ãƒªã‚»ãƒƒãƒˆï¼‰
  - Change email addressï¼ˆãƒ¡ãƒ¼ãƒ«å¤‰æ›´ï¼‰

- [ ] **3-2**: ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆå†…å®¹

  **ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ãƒªã‚»ãƒƒãƒˆä¾‹:**
  ```html
  <h2>ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ãƒªã‚»ãƒƒãƒˆ</h2>
  <p>ãƒœãƒã®ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ãƒªã‚»ãƒƒãƒˆãŒãƒªã‚¯ã‚¨ã‚¹ãƒˆã•ã‚Œã¾ã—ãŸã€‚</p>
  <p>ä»¥ä¸‹ã®ãƒªãƒ³ã‚¯ã‚’ã‚¯ãƒªãƒƒã‚¯ã—ã¦ã€æ–°ã—ã„ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ã‚’è¨­å®šã—ã¦ãã ã•ã„ï¼š</p>
  <p><a href="{{ .ConfirmationURL }}">ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ã‚’ãƒªã‚»ãƒƒãƒˆ</a></p>
  <p>ã“ã®ãƒªã‚¯ã‚¨ã‚¹ãƒˆã«å¿ƒå½“ãŸã‚ŠãŒãªã„å ´åˆã¯ã€ã“ã®ãƒ¡ãƒ¼ãƒ«ã‚’ç„¡è¦–ã—ã¦ãã ã•ã„ã€‚</p>
  <p>ãƒœãƒé‹å–¶ãƒãƒ¼ãƒ </p>
  ```

- [ ] **3-3**: å„ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆã®ãƒ†ã‚¹ãƒˆ

---

### ğŸ”§ Phase 4: Edge Functionä½œæˆï¼ˆPhase 2å®Ÿè£…æ™‚ï¼‰

- [ ] **4-1**: Edge Functionä½œæˆ
  - `supabase/functions/send-email/index.ts`

- [ ] **4-2**: Stripe Webhookã‹ã‚‰å‘¼ã³å‡ºã—
  - subscriptionæˆåŠŸ/è§£ç´„æ™‚ã«ãƒ¡ãƒ¼ãƒ«é€ä¿¡

- [ ] **4-3**: ãƒ†ã‚¹ãƒˆ

---

## ç’°å¢ƒå¤‰æ•°

### Vercelï¼ˆæœ¬ç•ªï¼‰

```
RESEND_API_KEY=re_xxxxxxxxxx
```

### Supabase Edge Functions

```bash
supabase secrets set RESEND_API_KEY=re_xxxxxxxxxx
```

---

## ãƒ†ã‚¹ãƒˆãƒã‚§ãƒƒã‚¯ãƒªã‚¹ãƒˆ

### Phase 1å®Œäº†æ¡ä»¶

- [ ] ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ãƒªã‚»ãƒƒãƒˆãƒ¡ãƒ¼ãƒ«ãŒå±Šã
- [ ] é€ä¿¡å…ƒãŒã€Œãƒœãƒ <noreply@bono.design>ã€
- [ ] ãƒ¡ãƒ¼ãƒ«å†…å®¹ãŒæ—¥æœ¬èªã§ãƒ–ãƒ©ãƒ³ãƒ‰ã«åˆã£ã¦ã„ã‚‹
- [ ] ãƒªãƒ³ã‚¯ãŒæ­£ã—ãæ©Ÿèƒ½ã™ã‚‹

### Phase 2å®Œäº†æ¡ä»¶

- [ ] æ–°è¦ç™»éŒ²ã§ã‚¦ã‚§ãƒ«ã‚«ãƒ ãƒ¡ãƒ¼ãƒ«é€ä¿¡
- [ ] ã‚µãƒ–ã‚¹ã‚¯é–‹å§‹ã§é€šçŸ¥ãƒ¡ãƒ¼ãƒ«é€ä¿¡
- [ ] ã‚µãƒ–ã‚¹ã‚¯è§£ç´„ã§é€šçŸ¥ãƒ¡ãƒ¼ãƒ«é€ä¿¡

---

## å‚è€ƒãƒªãƒ³ã‚¯

- [Resendå…¬å¼ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆ](https://resend.com/docs)
- [Resend + Supabase SMTPé€£æº](https://resend.com/docs/send-with-supabase-smtp)
- [Supabase Email Templates](https://supabase.com/docs/guides/auth/auth-email-templates)
- [Resendæ–™é‡‘](https://resend.com/pricing) - Free: 3,000 emails/month
