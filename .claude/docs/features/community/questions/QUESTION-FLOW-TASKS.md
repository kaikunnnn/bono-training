# 質問機能：投稿〜回答フロー改善タスク

**作成日**: 2025-02-23
**ステータス**: ✅ 完了

---

## 現状のフロー図

```
【質問者】                    【カイくん】                  【システム】
    │                              │                           │
    ├─ /questions で              │                           │
    │  「質問する」クリック        │                           │
    │                              │                           │
    ├─ ステップ形式で入力 ✅       │                           │
    │  (4ステップ)                 │                           │
    │                              │                           │
    ├─ 投稿完了画面 ✅             │                           │
    │  ・Slackリンク               │                           │
    │  ・自分の質問表示            │                           │
    │                              │                           │
    │                         Slack通知受信 ✅                  │
    │                         「新しい質問だよ」                │
    │                              │                           │
    │                         ❓ どこで質問を見る？             │
    │                         ❓ どうやって回答する？            │
    │                         ❓ どうやって公開する？            │
    │                              │                           │
    ❓ 回答が来たことをどう知る？   │                           │
    ❓ どこで回答を見る？           │                           │
```

---

## 🔴 P0: 回答者（カイくん）のワークフロー

### 現状確認

Sanityスキーマに必要なフィールドは**すべて揃っている**：

| フィールド | 説明 | 状態 |
|-----------|------|------|
| `status` | pending / answered / hidden | ✅ 存在 |
| `isPublic` | 公開フラグ | ✅ 存在 |
| `answerContent` | 回答内容（リッチテキスト） | ✅ 存在 |
| `questionContent` | 質問内容 | ✅ 存在 |
| `author` | 投稿者情報 | ✅ 存在 |

### 回答ワークフロー（手順）

```
1. Slackで通知を受信
   └─ 「新しい質問が投稿されました」
   └─ [Sanity Studioで確認] ボタンをクリック

2. Sanity Studioで質問を開く
   └─ URL: https://bono-training.sanity.studio/structure/question;{質問ID}

3. 「コンテンツ」タブで回答を入力
   └─ answerContent フィールドに回答を書く

4. 「管理情報」タブでステータスを変更
   └─ status: 「回答待ち」→「回答済み」
   └─ isPublic: ON

5. 保存（Publish）
```

### タスク

- [ ] **P0-1**: 回答ワークフローのドキュメント作成（カイくん用マニュアル）
- [ ] **P0-2**: Slack通知のメッセージを改善（手順リンク追加）

---

## 🔴 P1: 質問者への回答通知

### 現状

- 回答されても質問者に通知が行かない
- 質問者は自分で確認しに行くしかない

### 選択肢

| 案 | 方法 | メリット | デメリット |
|----|------|---------|-----------|
| A | メール通知 | 確実に届く | 実装コスト高、Resend連携必要 |
| B | Slack通知 | 既存の仕組み活用 | 全員がSlackにいるとは限らない |
| C | アプリ内通知 | UX良い | 実装コスト高、見逃しやすい |

### 推奨

**案A: メール通知**（Resendは既に導入済み）

### タスク

- [ ] **P1-1**: 回答通知メールのテンプレート作成
- [ ] **P1-2**: Sanity Webhook設定（status変更時にトリガー）
- [ ] **P1-3**: 通知API実装（Vercel Serverless Function）

---

## 🔴 P2: 質問者が回答を見る導線

### 現状

- `/questions` には公開済みの質問のみ表示
- 自分の質問（回答待ち含む）を見る場所がない

### 選択肢

| 案 | 方法 | 説明 |
|----|------|------|
| A | /questions に「あなたの質問」タブ | 一覧ページ内で切り替え |
| B | /mypage に「あなたの質問」セクション | マイページに集約 |
| C | /questions/mine 専用ページ | 独立したページ |

### 推奨

**案B: /mypage に追加**（マイページに「あなたの質問」セクション）

### タスク

- [ ] **P2-1**: マイページに「あなたの質問」セクション追加
- [ ] **P2-2**: 質問一覧API（自分の質問のみ取得）

---

## 🟡 P3: 体験上の課題

### 待機中の不安解消

| 課題 | 対策 |
|------|------|
| いつ回答が来るかわからない | 「通常1-3日以内」を明記 ✅ 実装済み |
| 進捗が見えない | ステータス表示（確認中 / 回答作成中） |

### タスク

- [ ] **P3-1**: ステータスの細分化を検討（pending → reviewing → drafting → answered）

---

## 📋 タスク一覧（優先度順）

| ID | タスク | 優先度 | 状態 |
|----|--------|--------|------|
| P0-1 | 回答ワークフローのドキュメント作成 | P0 | ✅ 完了 |
| P0-2 | Slack通知メッセージ改善 | P0 | ✅ 完了 |
| P1-1 | 回答通知メールテンプレート作成 | P1 | ✅ 完了 |
| P1-2 | Sanity Webhook設定 | P1 | ✅ 完了（設定ガイド作成） |
| P1-3 | 通知API実装 | P1 | ✅ 完了 |
| P2-1 | マイページに「あなたの質問」追加 | P2 | ✅ 完了 |
| P2-2 | 自分の質問取得API | P2 | ✅ 完了 |
| P3-1 | ステータス細分化検討 | P3 | ⬜ 未着手（低優先度） |

---

## 実装済み機能

- [x] ステップ形式の質問投稿フォーム
- [x] 投稿完了画面（Slackリンク + 自分の質問表示）
- [x] Slack通知（新しい質問投稿時）＋手順ガイド付き
- [x] Sanityスキーマ（回答フィールド、ステータス、公開フラグ）
- [x] 回答ワークフローマニュアル（カイくん用）
- [x] 回答通知API（Sanity Webhook → Resend）
- [x] Sanity Webhook設定ガイド
- [x] マイページに「あなたの質問」セクション

---

## 次のアクション

**テスト**:
1. ローカルで質問投稿フローを確認
2. Sanity WebhookをPRODUCTION-VERIFICATION.mdの手順で設定
3. 回答→メール通知のE2Eテスト

---

## 更新履歴

| 日付 | 更新内容 |
|------|---------|
| 2025-02-23 | 全タスク完了（P0-1〜P2-2） |
| 2025-02-23 | 初版作成、PMレビュー結果をまとめ |
