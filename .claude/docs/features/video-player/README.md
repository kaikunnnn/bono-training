# 動画プレイヤー機能

**最終更新**: 2026-01-13
**ステータス**: ✅ アドブロッカー対応完了
**ブランチ**: `feature/video-player-ui`

---

## 概要

記事詳細ページで使用するVimeoカスタム動画プレーヤー。
標準のVimeo埋め込みではなく、独自UIでより良い再生体験を提供する。

**アドブロッカー対応**: アドブロッカーが検出された場合は自動的に標準プレーヤーにフォールバック。

---

## ファイル構成

```
src/components/video/
├── CustomVimeoPlayer.tsx     # メインコンポーネント（フォールバック対応）
├── VimeoFallbackPlayer.tsx   # アドブロッカー用フォールバックプレーヤー
├── VideoControls.tsx         # コントロールバーUI
└── hooks/
    └── useVimeoPlayer.ts     # Vimeo Player APIフック（アドブロッカー検出機能付き）
```

---

## アドブロッカー対応

### 検出方法
1. Vimeo Player APIの`ready()`イベントを監視
2. 5秒以内に初期化されなければアドブロッカーと判断
3. エラーイベント（PrivacyError等）でも検出

### フォールバック動作
- `state.isAdBlocked = true` でフォールバック表示
- 警告メッセージ + 標準iframe埋め込み
- Vimeo Player APIを使わないため、アドブロッカーの影響を受けない

---

## 解決済みの問題点

詳細: [current-issues.md](./current-issues.md)

| # | 問題 | 対応 |
|---|------|------|
| 1 | Vimeo標準UIとカスタムUIが重複表示 | ✅ 解決 |
| 2 | 再生ボタンクリック後もUIが表示されたまま | ✅ 解決 |
| 3 | シークバー（再生位置）クリックが効かない | ✅ 解決 |
| 4 | 操作後にUIが自動非表示にならない | ✅ 解決 |
| 5 | アドブロッカー環境で動作しない | ✅ フォールバック対応 |

---

## 修正計画

詳細: [fix-plan.md](./fix-plan.md)

| Phase | 内容 | ステータス |
|-------|------|------------|
| 1 | Vimeo標準UI非表示化 | ✅ 完了 |
| 2 | ポインターイベント修正 | ✅ 完了 |
| 3 | コントロール表示/非表示ロジック修正 | ✅ 完了 |
| 4 | アドブロッカー検出・フォールバック | ✅ 完了 |
| 5 | 動作確認 | ⏳ 確認待ち |

---

## 関連ドキュメント

- [current-issues.md](./current-issues.md) - 現在の問題点詳細
- [fix-plan.md](./fix-plan.md) - 修正計画詳細
