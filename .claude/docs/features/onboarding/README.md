# アルファ版運用計画（簡略化アプローチ）

**作成日**: 2025-01-21
**最終更新**: 2025-01-22（実装完了）
**ステータス**: ✅ 実装完了（bono-training側）
**関連ブランチ**: `feat/memberstack-account-sync`

---

## 🎯 方針（2025-01-22 決定）

**bono-trainingでは新規登録・決済を行わない（アルファ版期間中）**

```
【役割分担】

bo-no.design（本サイト）
├── 新規アカウント登録
├── 決済・課金管理
├── 既存コンテンツ（ロードマップ、コース、コミュニティ等）
└── 新レッスンへのリンク設置 ← NEW

bono-training（アルファ版）
├── 新しいレッスンコンテンツの閲覧 ← これがメイン
├── ログイン機能（bo-no.designアカウントで）
└── 決済機能 → 非表示（実装は残す、将来使用）
```

**理由**:
- 2サイト間の同期・整合性の複雑さを回避
- 「新しいレッスンを先行公開したい」という目的に集中
- 1年以内に全機能をbono-trainingに移行予定

---

## 🔄 サブスクリプション同期（実装済み）

**双方向同期が完成している**ため、どちらで課金してもサブスク情報は同期される。

```
bo-no.design で課金
    ↓
Stripe Webhook (customer.subscription.created)
    ↓
bono-training の stripe-webhook Edge Function
    ↓
Supabase に自動同期（ユーザー作成 + サブスク情報）
    ↓
bono-training の /account ページでも正しく表示
```

| 方向 | 仕組み | ステータス |
|------|--------|-----------|
| 新→旧 | bono-training → Memberstack | ✅ 実装済み |
| 旧→新 | bo-no.design → Supabase | ✅ 2025-01-13 完了 |

**参照**: `.claude/docs/features/auto-sync/PLAN.md`

---

## 📋 タスク一覧（簡略化版）

| # | タスク | ステータス | 優先度 | 備考 |
|---|--------|-----------|--------|------|
| 1 | 有料記事ペイウォールの改修 | ✅ 完了 | 🔴最重要 | bo-no.designへの誘導 + モーダルで流れ説明 |
| 2 | ログインページの改修（タブUI） | ✅ 完了 | 🔴最重要 | 「通常ログイン」「初めての方」「新規登録」の3タブ |
| 3 | 新規登録画面の改修 | ✅ 完了 | 🔴最重要 | 登録フォーム→RegistrationFlowGuideに置き換え |
| 4 | RegistrationFlowGuideコンポーネント作成 | ✅ 完了 | 🔴最重要 | ペイウォール・新規登録で共通利用 |
| 5 | ページの非表示化 + 開発用リンク | ✅ 完了 | 🟡中 | フッターにdev用リンク追加 |
| 6 | bo-no.designに新レッスンリンク設置 | ⏳ 未着手 | 🟡中 | Webflow側の作業 |
| 7 | bo-no.design登録完了後の案内 | ⏳ 未着手 | 🟡中 | bono-trainingへの戻り導線 |

---

## ユーザーフロー（簡略化版）

### 🔴 フロー1: 新規ユーザーがbono-trainingに直接来る（最重要）

**これが一番多い流入経路。離脱させずにbo-no.designでの登録まで導くのが最重要課題。**

```
1. SNS/検索などでbono-trainingのコンテンツを発見
2. bono-training のレッスンページに直接訪問
3. 「このコンテンツやりたい！」と思う
4. 有料記事に当たる → 新規登録したい
5. ペイウォール表示
   └── 「ログインする」ボタン
   └── 「初めての方」ボタン → モーダルで流れを説明
6. モーダルで全体の流れを確認
   └── ① bo-no.designで会員登録
   └── ② 戻ってきてログイン
   └── ③ コンテンツが見れる
7. bo-no.design に遷移
8. bo-no.design で新規アカウント登録 & 決済
9. bono-training に戻る
10. ログインページで「初めての方」タブを選択
11. メールアドレス入力 → パスワード設定
12. 有料コンテンツを閲覧できる
```

**ポイント**:
- ステップ5→6 モーダルで事前に流れを説明し、安心感を与える
- ステップ10→11 「パスワードを忘れた」ではなく「初めての方」として正しいフレーミング

---

### フロー2: 既存ユーザー（bo-no.design会員）が新しいレッスンを見る

```
1. bo-no.design にログイン中
2. 「新しいレッスンはこちら」リンクをクリック
3. bono-training に遷移
4. ログインページで「初めての方」タブを選択
5. メールアドレス入力 → パスワード設定
6. 新しいレッスンコンテンツを閲覧
```

※2回目以降は「通常ログイン」タブで普通にログイン可能

---

### フロー3: bo-no.designから来る新規ユーザー

```
1. bo-no.design で新規アカウント登録 & 決済
2. bo-no.design のコンテンツを利用開始
3. bo-no.design 内で「新しいレッスンはこちら」リンクを発見
4. bono-training に遷移
5. ログインページで「初めての方」タブを選択
6. メールアドレス入力 → パスワード設定
7. 新しいレッスンコンテンツを閲覧
```

---

## 必要な実装

### 🔴 1. ペイウォールの改修（最重要）

**目的**: bono-trainingに直接来た新規ユーザーを、離脱させずにbo-no.designでの登録に導く

**改修対象**: 使用中のペイウォールコンポーネント全て（未使用のものは削除）
- `FallbackContent.tsx` - 汎用ガード
- `ContentPreviewOverlay.tsx` - 記事プレビュー用（使用状況を確認して判断）

**モーダル実装**: 既存のshadcn/ui `Dialog` コンポーネントを使用

**ユーザー状態による表示分岐**:

| ユーザー状態 | 表示内容 |
|-------------|---------|
| 未ログイン | 「ログインする」+「初めての方はこちら」 |
| ログイン済み・サブスクなし | 「メンバー登録」への導線のみ（bo-no.designへ誘導） |
| ログイン済み・サブスクあり | コンテンツ表示（ペイウォールなし） |

**現状の文言**: 「ログインかプランを登録しよう」

**変更後（案）**:
```
┌─────────────────────────────────────────────────┐
│  このレッスンを見るにはログインが必要です        │
│                                                 │
│  [ ログインする ]                               │
│                                                 │
│  ─────────────────────────────────────────────  │
│                                                 │
│  [ 初めての方はこちら ]  ← モーダルを開く        │
│                                                 │
└─────────────────────────────────────────────────┘
```

**「初めての方はこちら」クリック時のモーダル**:
```
┌─────────────────────────────────────────────────┐
│  会員登録の流れ                          × 閉じる│
│                                                 │
│  ① bo-no.design で会員登録                      │
│     決済もこちらで完了します                     │
│                                                 │
│  ② このページに戻ってログイン                    │
│     同じメールアドレスでログインできます          │
│                                                 │
│  ③ すべてのレッスンが見れるようになります        │
│                                                 │
│  ─────────────────────────────────────────────  │
│                                                 │
│  [ bo-no.design で会員登録する → ]              │
│                                                 │
└─────────────────────────────────────────────────┘
```

**ポイント**:
- モーダルで事前に全体の流れを説明 → 安心感を与える
- ステップ番号で「やることリスト」として明示
- 「戻ってきてログイン」を明記 → 迷子にならない

---

### 🔴 2. ログインページの改修（タブUI）

**場所**: `/auth` ページ

**目的**:
- 「パスワードを忘れた」ではなく「初めてパスワードを設定する」という正しいフレーミング
- 通常ログインと初回ログインのユースケースを明確に分離

**UI構成**:
```
┌─────────────────────────────────────────────────┐
│  ログイン                                        │
│                                                 │
│  [ 通常ログイン ]  [ 初めての方 ]  ← タブ        │
│                                                 │
└─────────────────────────────────────────────────┘
```

**【通常ログイン】タブ**:
```
┌─────────────────────────────────────────────────┐
│                                                 │
│  メールアドレス                                  │
│  [ _________________________ ]                  │
│                                                 │
│  パスワード                                      │
│  [ _________________________ ]                  │
│                                                 │
│  [ ログイン ]                                   │
│                                                 │
│  パスワードを忘れた方はこちら                    │
│                                                 │
└─────────────────────────────────────────────────┘
```

**【初めての方】タブ**:
```
┌─────────────────────────────────────────────────┐
│                                                 │
│  bo-no.design で登録したメールアドレスを         │
│  入力してください。                              │
│                                                 │
│  メールアドレス                                  │
│  [ _________________________ ]                  │
│                                                 │
│  [ パスワードを設定する ]                        │
│                                                 │
│  ─────────────────────────────────────────────  │
│                                                 │
│  まだ会員登録していない方は                       │
│  bo-no.design で登録してください                 │
│                                                 │
└─────────────────────────────────────────────────┘
```

**【初めての方】タブのフロー**:
1. メールアドレスを入力
2. 「パスワードを設定する」をクリック
3. Supabaseでメールアドレスの存在を確認
   - 存在する → パスワード設定メールを送信
   - 存在しない → 「bo-no.designで先に登録してください」と表示
4. メールのリンクからパスワードを設定
5. 設定完了後、「通常ログイン」タブでログイン可能に

**技術的な補足**:
- Supabase内部的には「パスワードリセット」と同じ処理
- 違いはUXのフレーミングのみ（「忘れた」→「初めて設定」）

**既存の移行ユーザー機能について**:
- 現在、ログイン失敗時に`isMigratedUser`チェックで移行ユーザー向けメッセージを表示する機能がある
- **この機能は残す**（両方残す）
- 理由: タブを見ずにログインだけ試して失敗するユーザーへのフォローアップとして必要
- 「初めての方」タブ → 能動的に選ぶユーザー向け
- 移行ユーザー機能 → タブを見なかったユーザーへのフォロー

---

### 🔴 3. 新規登録画面の改修

**場所**: `/auth` ページの「新規登録」タブ（または画面）

**目的**:
- 新規登録フォームを表示しても、課金はbo-no.designでしかできない
- 中途半端な状態を避け、正しくbo-no.designへ誘導する

**現状**:
```
┌─────────────────────────────────────────────────┐
│  新規登録                                        │
│                                                 │
│  メールアドレス                                  │
│  [ _________________________ ]                  │
│                                                 │
│  パスワード                                      │
│  [ _________________________ ]                  │
│                                                 │
│  [ 登録する ]                                   │
│                                                 │
└─────────────────────────────────────────────────┘
```

**変更後**:
```
┌─────────────────────────────────────────────────┐
│  新規登録                                        │
│                                                 │
│  ┌─────────────────────────────────────────┐    │
│  │  会員登録の流れ                          │    │
│  │                                         │    │
│  │  ① bo-no.design で会員登録               │    │
│  │     決済もこちらで完了します              │    │
│  │                                         │    │
│  │  ② このページに戻ってログイン             │    │
│  │     同じメールアドレスでログインできます   │    │
│  │                                         │    │
│  │  ③ すべてのレッスンが見れるようになります │    │
│  │                                         │    │
│  │  [ bo-no.design で会員登録する → ]       │    │
│  └─────────────────────────────────────────┘    │
│                                                 │
└─────────────────────────────────────────────────┘
```

**注意**: 既存の登録フォームのコードは削除しない。将来の移行時に使用する。

---

### 🔴 4. RegistrationFlowGuide コンポーネント

**目的**: 「会員登録の流れ」説明を共通コンポーネント化

**使用箇所**:
- ペイウォールのモーダル内（タスク1）
- `/auth` ページの「新規登録」タブ内（タスク3）

**ファイル**: `src/components/auth/RegistrationFlowGuide.tsx`

```tsx
interface RegistrationFlowGuideProps {
  /** 表示バリエーション */
  variant?: 'modal' | 'page';
  /** bo-no.designに遷移時のコールバック（トラッキング等） */
  onNavigate?: () => void;
}

export const RegistrationFlowGuide: React.FC<RegistrationFlowGuideProps> = ({
  variant = 'page',
  onNavigate
}) => {
  const handleClick = () => {
    onNavigate?.();
    window.open('https://www.bo-no.design/plan', '_blank');
  };

  return (
    <div className={variant === 'modal' ? '' : 'p-6 border rounded-lg'}>
      <h3 className="font-bold text-lg mb-4">会員登録の流れ</h3>

      <ol className="space-y-4 mb-6">
        <li className="flex gap-3">
          <span className="font-bold">①</span>
          <div>
            <p className="font-medium">bo-no.design で会員登録</p>
            <p className="text-sm text-muted-foreground">決済もこちらで完了します</p>
          </div>
        </li>
        <li className="flex gap-3">
          <span className="font-bold">②</span>
          <div>
            <p className="font-medium">このページに戻ってログイン</p>
            <p className="text-sm text-muted-foreground">同じメールアドレスでログインできます</p>
          </div>
        </li>
        <li className="flex gap-3">
          <span className="font-bold">③</span>
          <div>
            <p className="font-medium">すべてのレッスンが見れるようになります</p>
          </div>
        </li>
      </ol>

      <Button onClick={handleClick} className="w-full">
        bo-no.design で会員登録する
        <ExternalLink className="ml-2 h-4 w-4" />
      </Button>
    </div>
  );
};
```

---

### 🟡 5. 非表示対象ページ + 開発用リンク

#### 非表示にするページ

| ページ | パス | 対応内容 |
|--------|------|----------|
| サブスクリプション | `/subscription` | ナビ・フッターから削除 |
| Training新規登録 | `/training/signup` | ナビから削除 |
| Trainingプラン | `/training/plan` | ナビから削除 |

**注意**: コードは削除しない。非表示にするだけ。将来使用する。

#### 非表示にしないページ

| ページ | パス | 理由 |
|--------|------|------|
| アカウント設定 | `/account` | サブスク情報は自動同期されるため表示OK |
| マイページ | `/mypage` | お気に入り・履歴・進捗（コンテンツ関連） |
| プロフィール | `/profile` | 基本情報のみ |

**補足**: bo-no.design → Supabase の自動同期が実装済み（2025-01-13完了）のため、
bo-no.designで課金したユーザーのサブスク情報はbono-trainingでも正しく表示される。

#### 開発用フッターリンク

**目的**: 開発環境でのみ、非表示ページにアクセスできるようにする

**実装箇所**: `src/components/layout/Footer.tsx`

```tsx
{/* 開発環境のみ: サイトマップリンク */}
{import.meta.env.DEV && (
  <div className="flex flex-wrap justify-center gap-x-4 gap-y-1 mb-2 text-xs text-gray-400">
    <span className="text-gray-500">[Dev]</span>
    <Link to="/subscription">Subscription</Link>
    <Link to="/training/signup">Training Signup</Link>
    <Link to="/training/plan">Training Plan</Link>
    <Link to="/account">Account</Link>
    <Link to="/dev">Dev Home</Link>
  </div>
)}
```

**動作**:
- 本番環境（`npm run build`）: リンク非表示
- 開発環境（`npm run dev`）: `[Dev]` ラベル付きでリンク表示

---

### 🟡 4. bo-no.design側の対応（Webflow）

**追加内容**:
- 新しいレッスンページへのリンクを設置
- 「アルファ版で新しいレッスンを先行公開中」の案内

---

### 🟡 5. bo-no.design登録完了後の案内

**目的**: bo-no.designで登録したユーザーがbono-trainingに戻ってこれるようにする

**追加内容**（bo-no.design側 or ウェルカムメール）:
```
新しいレッスンは bono-training.vercel.app で公開中です。
同じメールアドレスでログインできます。
ログインページの「初めての方」タブからパスワードを設定してください。
```

---

## 将来の計画

**1年以内に実施予定**:
- bo-no.design から bono-training への完全移行
- bono-training での新規登録・決済機能の有効化
- 現在非表示にしている機能の復活

---

## 関連ドキュメント

- 機能一覧: `.claude/docs/features/README.md`
- アイコンルール: `.claude/PROJECT-RULES.md`（UI/デザインルール）
- **旧→新 自動同期**: `.claude/docs/features/auto-sync/PLAN.md`（bo-no.design課金→Supabase同期）

---

## 更新履歴

| 日付 | 内容 |
|------|------|
| 2025-01-22 | 確認事項反映: ユーザー状態分岐、移行ユーザー機能両立、URL修正、モーダルUI決定 |
| 2025-01-22 | 非表示対象ページ整理 + 開発用フッターリンク追加 |
| 2025-01-22 | ログインページ改修追加: タブUIで「通常ログイン」と「初めての方」を分離 |
| 2025-01-22 | ペイウォール改修追加: モーダルで登録フローを事前説明 |
| 2025-01-22 | 方針変更: bo-no.designに登録・決済を集約、bono-trainingはコンテンツ閲覧のみ |
| 2025-01-22 | ギャップ整理（メール送信は実装済み確認、重複統合でギャップ数を10→7に削減） |
| 2025-01-22 | ユーザーフロー追加・ギャップ分析追加 |
| 2025-01-22 | ドキュメント整理・タスク一覧追加 |
| 2025-01-21 | Iconsax移行（`@/lib/icons` 使用） |
| 2025-01-21 | Phase 1〜2 完了（UI実装・リンク設定） |
| 2025-01-21 | 初版作成（計画策定） |

---
---
---

<!--
================================================================================
以下は旧計画（bono-trainingで新規登録・決済を行う想定）のアーカイブです。
将来の完全移行時に参照する可能性があるため、削除せずコメントアウトで保持。
================================================================================
-->

<!--
## 📋 タスク一覧（旧計画）

| # | タスク | ステータス | 備考 |
|---|--------|-----------|------|
| 1 | UI設計・計画策定 | ✅ 完了 | |
| 2 | OnboardingSectionコンポーネント作成 | ✅ 完了 | |
| 3 | 学習コンテンツセクション追加 | ✅ 完了 | レッスン・トレーニングへのリンク |
| 4 | 旧サイト案内セクション追加 | ✅ 完了 | 新規登録時のみ表示 |
| 5 | アカウント管理セクション追加 | ✅ 完了 | |
| 6 | 旧サイトログインURL設定 | ✅ 完了 | `https://bo-no.design/login` |
| 7 | Iconsax移行 | ✅ 完了 | `@/lib/icons` を使用 |
| 8 | ビルド確認 | ✅ 完了 | |
| 9 | 新規登録フローでの表示確認 | ⏳ 未着手 | 実際のチェックアウト通過が必要 |
| 10 | プラン変更フローでの表示確認 | ⏳ 未着手 | 旧サイト案内が非表示になることを確認 |
| 11 | レスポンシブ対応確認 | ⏳ 未着手 | |
-->

<!--
## 概要（旧計画）

サブスクリプション登録完了後のページ（`/subscription/success`）を改善し、ユーザーが次に何をすべきかを明確に案内するオンボーディング機能を追加する。

### 背景

1. **情報不足**: 現在のページは「決済完了」の確認のみで、次のステップが不明瞭
2. **旧サイト案内なし**: Memberstack連携で旧サイト（bo-no.design）も利用可能だが案内がない
3. **コンテンツへの導線不足**: 「レッスンを見る」だけでは不十分

### 関連機能

- **Memberstack同期**: 新規登録時にSupabase → Memberstackへユーザー情報を同期
- 同期によりbo-no.designへのアクセスが可能になるが、初回ログイン時はパスワードリセットが必要
-->

<!--
## ユーザーフロー（旧計画: bono-trainingで新規登録する場合）

### bono-training.vercel.app(アルファ版先行公開) で新規登録したひと

#### bono-training.vercel.app(アルファ版先行公開）で登録する
1. レッスンページ
   1. レッスンの記事を見ていく
   2. 有料の記事に当たる
   3. "ログインかプランを登録しよう"の導線が目に入る
2. サブスクリプションページ
   1. プラン登録の検討のためプラン内容確認する
   2. プラン選択する
   3. が、プラン登録にはたぶん「新規アカウント登録」が必要
   4. 新規アカウントのフローに行く
3. 新規アカウント作成
   1. /authで新規アカウント作成
   2. できればリダイレクトして、選択したプランで決済画面に行きたいけど可能か？
4. 決済画面-Stripe
5. 決済完了画面
   1. /subscription/success → 新規登録の時のみ出る
   2. 本サイト(bo-no.design)も利用できますの内容も書いてある
      1. 本サイトだとロードマップやコースなど多くのコンテンツを観ることができます
      2. ※絶賛開発中で仕組みをこちらで移行中ですが〜〜の説明も補足的に付ける
6. 新規2プラン登録完了しましたメールが飛ぶ
   1. オンボーディングの内容
   2. BONO本サイトも使えますからつかってねの内容と説明（説明頁があったほうが良い？そんなに内容内から要らない？）
7. レッスンを再開する

#### bo-no.designもつかう
1. ログインページ
2. "アルファ版で新規登録した人はこちら"のタブ
3. パスワードリセットしてパスワードをこちらのサイトで設定しましょうの指示→パスワードリセット
4. リセット完了
5. ログインページでログイン
6. 有料動画がbo-no.designでも閲覧できる


### bo-no.design で新規登録したひと
#### bono-training.vercel.app(アルファ版先行公開）を使う
1. ログインページ /auth
2. "本サイトの人はこちら"のタブがある
3. パスワードリセットをしてパスワードをこちらの生徒で設定してくださいの指示
4. パスワードリセット
5. /authでログイン
6. ログインできる
-->

<!--
## ギャップ分析（旧計画）

### ギャップ1: bo-no.designの価値説明がない 🔴

**要求**: 「本サイトだとロードマップやコースなど多くのコンテンツを観ることができます」

**現状**: 決済完了画面に具体的な価値説明なし

**対応アイデア**:

| アイデア | 内容 | メリット | デメリット |
|----------|------|----------|------------|
| **A: 画面内に直接追記** | 旧サイトセクションの説明文を拡充し、ロードマップ・コース・コミュニティの価値を記載 | 実装が簡単、すぐ対応可能 | 画面が長くなる |
| **B: 専用説明ページ作成** | `/guide/legacy-site` のような説明ページを作り、そこへリンク | 画面がスッキリ、詳細な説明が可能 | ページ作成の工数が必要 |
| **C: 折りたたみ表示** | 「詳しく見る」で展開する形式 | 画面スッキリ＋詳細も見れる | 見落とされる可能性 |

### ギャップ2: アルファ版であることの説明がない 🔴

**要求**: 「※絶賛開発中で仕組みをこちらで移行中ですが〜〜」の補足説明

**現状**: アルファ版・開発中である説明なし

**対応アイデア**:

| アイデア | 内容 | メリット | デメリット |
|----------|------|----------|------------|
| **A: 決済完了画面に注記追加** | 旧サイトセクションの下に補足テキストを追加 | すぐ対応可能 | 目立たない可能性 |
| **B: サイト全体にバナー表示** | ヘッダー下などに「アルファ版公開中」バナー | 常に認識される | 邪魔になる可能性 |
| **C: フッターに記載** | サイトフッターに開発中の旨を記載 | 控えめ | 見られない可能性が高い |

### ギャップ3: ウェルカムメールの内容に新サイト情報がない 🔴

**要求**:
- オンボーディングの内容をメールに含める
- 「BONO本サイトも使えますからつかってね」の内容と説明

**現状**:
- ✅ メール送信機能は実装済み（`stripe-webhook` → `checkout.session.completed` でResend経由送信）
- ❌ 現在のテンプレートは旧サイト（bo-no.design）のみ案内
- ❌ 新サイト（bono-training）への言及なし、両サイト使い分け説明なし

**対応アイデア**:

| アイデア | 内容 | メリット | デメリット |
|----------|------|----------|------------|
| **A: 案1を採用** | 新サイト案内セクションを追加 | 目立つ、分かりやすい | メールが長くなる |
| **B: 案2を採用** | 両サイトの使い分けを詳細に説明 | 情報が充実、整理されている | メールが長くなる |
| **C: 案3を採用** | 補足テキストにシンプルに追記 | スッキリ | 情報が少ない |

**実装箇所**: `supabase/functions/_shared/email-templates.ts` の `generateWelcomeEmail()`

### ギャップ4: /authに旧サイトユーザー向け導線がない 🔴

**要求**:
- 「本サイト（bo-no.design）の人はこちら」タブ
- パスワードリセットして設定してくださいの指示

**現状**: 旧サイトユーザー向けのパスワードリセット導線がない

**対応アイデア**:

| アイデア | 内容 | メリット | デメリット |
|----------|------|----------|------------|
| **A: タブ切り替えUI** | 「新規登録」「ログイン」に加えて「本サイト会員の方」タブを追加 | 分かりやすい、導線が明確 | UI変更の工数 |
| **B: 注意書き追加** | ログインフォームの下に「bo-no.design会員の方はパスワードリセットしてください」のリンクを追加 | 最小限の変更 | 見落とされやすい |
| **C: 専用ページ作成** | `/auth/legacy-user` のような専用ページを作成 | 説明を丁寧にできる | ページ増加、導線が分散 |

### ギャップ5: bo-no.design側に新サイトユーザー向け導線がない 🟡

**要求**: 「アルファ版で新規登録した人はこちら」タブ

**現状**: bo-no.design側での対応が必要（Memberstack管理）

**対応アイデア**:

| アイデア | 内容 | メリット | デメリット |
|----------|------|----------|------------|
| **A: Memberstackカスタムページ** | ログインページに「アルファ版で登録した方」セクションを追加 | ユーザーに分かりやすい | Memberstack側の制約確認が必要 |
| **B: 説明ページへリンク** | bo-no.design内に説明ページを作成し、ログインページからリンク | 詳細な説明が可能 | Webflowでの作業が必要 |
| **C: 対応しない** | bono-trainingからの案内のみで対応 | 工数ゼロ | 旧サイトからの導線がない |

### ギャップ6: プラン選択状態を保持して決済に進めない 🟡

**要求**: 「できればリダイレクトして、選択したプランで決済画面に行きたい」

**現状**: 未確認（プラン選択状態を保持して決済に進む仕組みの確認が必要）

**対応アイデア**:

| アイデア | 内容 | メリット | デメリット |
|----------|------|----------|------------|
| **A: URLパラメータ** | `/auth?redirect=/subscription&plan=standard&duration=1` のようにパラメータで引き継ぎ | 実装がシンプル、リンク共有可能 | URLが長くなる |
| **B: localStorage** | 選択したプランをlocalStorageに保存し、ログイン後に復元 | URLがスッキリ | ブラウザ依存、クリアされる可能性 |
| **C: sessionStorage** | sessionStorageで一時保存 | タブ単位で管理、セキュア | タブを閉じると消える |

### ギャップ7: 旧→新の同期がない 🟡

**要求**: bo-no.designユーザーがbono-trainingでログイン可能

**現状**: Memberstack→Supabase同期なし。現状は新→旧の一方向のみ。旧→新は手動パスワードリセット依存

**対応アイデア**:

| アイデア | 内容 | メリット | デメリット |
|----------|------|----------|------------|
| **A: パスワードリセット依存（現状維持）** | 旧サイトユーザーは手動でパスワードリセットしてログイン | 追加開発不要 | ユーザー体験が悪い |
| **B: Memberstack Webhook連携** | Memberstackの会員登録/更新時にSupabaseへ同期 | 自動化、シームレス | Memberstack側の設定・開発が必要 |
| **C: 定期バッチ同期** | Memberstackの会員リストを定期的にSupabaseへインポート | 確実性が高い | リアルタイム性がない、API制限 |

## 対応優先度まとめ（旧計画）

### すぐ対応できるもの（現ブランチ内）

| 優先度 | ギャップ | 推奨アイデア |
|--------|----------|-------------|
| 1 | ギャップ1・2: 決済完了画面の文言追加 | A: 画面内に直接追記 |
| 2 | ギャップ3: ウェルカムメール内容の更新 | B: 案2（両サイト説明）を採用 |

### 別タスクとして必要なもの

| 優先度 | ギャップ | 推奨アイデア |
|--------|----------|-------------|
| 3 | ギャップ4: /authページ改修 | B: 注意書き追加（最小工数） |
| 4 | ギャップ5: bo-no.design側の改修 | C: 対応しない（当面） |
| 5 | ギャップ6: プラン選択→決済フロー | A: URLパラメータ |
| 6 | ギャップ7: 旧→新の同期 | A: 現状維持 |
-->

<!--
## 実装内容（旧計画: SubscriptionSuccessContent）

### 変更ファイル

| ファイル | 変更内容 |
|----------|----------|
| `src/components/subscription/SubscriptionSuccessContent.tsx` | UI全面改修 |
| `src/lib/icons.ts` | `Globe` アイコン追加 |
| `.claude/PROJECT-RULES.md` | Iconsax統一ルール追加 |

### 新しいUI構成

```
┌─────────────────────────────────────────────────┐
│  ✅ 登録が完了しました                           │
│  スタンダードプラン（1ヶ月）へようこそ！          │
├─────────────────────────────────────────────────┤
│                                                 │
│  ご登録ありがとうございます！                    │
│  以下のコンテンツにアクセスできるようになりました │
│                                                 │
│  ┌─────────────────────────────────────────┐    │
│  │ 📚 学習コンテンツ                        │    │
│  │ 体系的に学べるレッスンと、実践的な       │    │
│  │ トレーニングをご用意しています。          │    │
│  │ [ レッスン一覧を見る ] [ トレーニング ]   │    │
│  └─────────────────────────────────────────┘    │
│                                                 │
│  ┌─────────────────────────────────────────┐    │
│  │ 🌐 旧サイト（bo-no.design）も利用可能    │    │  ← 新規登録時のみ
│  │ 同じメールアドレスでアクセスできます。    │    │
│  │ 初回ログイン時は「パスワードを忘れた方」  │    │
│  │ からパスワードリセットをお願いします。    │    │
│  │ [ 旧サイトにログイン ]                   │    │
│  └─────────────────────────────────────────┘    │
│                                                 │
│  ┌─────────────────────────────────────────┐    │
│  │ ⚙️ アカウント管理                        │    │
│  │ サブスクリプションの確認・変更、         │    │
│  │ 請求情報の確認ができます。               │    │
│  │ [ アカウント設定を開く ]                 │    │
│  └─────────────────────────────────────────┘    │
│                                                 │
│              プラン一覧に戻る                   │
└─────────────────────────────────────────────────┘
```

### セクション表示条件

| セクション | 新規登録 (`type="new"`) | プラン変更 (`type="updated"`) |
|------------|------------------------|------------------------------|
| 学習コンテンツ | ✅ 表示 | ✅ 表示 |
| 旧サイト案内 | ✅ 表示 | ❌ 非表示 |
| アカウント管理 | ✅ 表示 | ✅ 表示 |
-->

<!--
## 技術仕様（旧計画）

### コンポーネント構成

```typescript
// OnboardingSection: 各セクションのカードコンポーネント
interface OnboardingSectionProps {
  icon: React.ReactNode;
  title: string;
  children: React.ReactNode;
}

// SubscriptionSuccessContent: メインコンポーネント
interface SubscriptionSuccessContentProps {
  type: 'new' | 'updated';
  planType: PlanType | null;
  duration?: 1 | 3 | null;
  isLoading: boolean;
  error: string | null;
}
```

### 定数

```typescript
const LEGACY_SITE_LOGIN_URL = 'https://bo-no.design/login';
```

### アイコン

`@/lib/icons` から以下を使用（Iconsax）:
- `CheckCircle2` - 成功アイコン
- `Loader2` - ローディング
- `BookOpen` - 学習コンテンツ
- `Globe` - 旧サイト
- `Settings` - アカウント管理
- `ExternalLink` - 外部リンク
-->

<!--
## テスト計画（旧計画）

### テスト1: 新規登録フロー

**手順**:
1. 新規アカウントでログイン
2. `/subscription` でプランを選択
3. Stripe Checkoutで決済完了
4. `/subscription/success` にリダイレクト

**確認項目**:
- [ ] 3つのセクションが全て表示される
- [ ] 旧サイト案内セクションが表示される
- [ ] 各ボタンが正しいURLに遷移する
- [ ] プラン名・期間が正しく表示される

### テスト2: プラン変更フロー

**手順**:
1. 既存サブスクリプションユーザーでログイン
2. `/subscription` でプランを変更
3. 決済完了後 `/subscription/success?type=updated` にリダイレクト

**確認項目**:
- [ ] 2つのセクションが表示される（学習コンテンツ・アカウント管理）
- [ ] 旧サイト案内セクションが**非表示**である
- [ ] 「プラン変更が完了しました」と表示される

### テスト3: レスポンシブ確認

**確認項目**:
- [ ] モバイル（320px〜）で正しく表示される
- [ ] タブレット（768px〜）で正しく表示される
- [ ] デスクトップ（1024px〜）で正しく表示される
- [ ] ボタンが縦並びになる（モバイル）
-->

<!--
## 将来の改善案（旧計画）

優先度順:

1. **ウェルカムメール内容更新**: 新サイト情報と両サイト使い分け説明を追加（送信機能は実装済み）
2. **登録メールアドレスの表示**: 旧サイトログイン用に明示
3. **次回更新日の表示**: 課金タイミングの透明性
4. **サポート導線**: 困った時の問い合わせ先
-->
