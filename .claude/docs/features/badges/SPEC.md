# 称号（バッジ）システム 仕様書

**作成日**: 2025-12-19
**ステータス**: 仕様検討中

---

## 概要

ユーザーの学習進捗に応じて「称号」を付与し、達成感とモチベーションを高める機能。

---

## ユーザー体験フロー

### 1. 称号を獲得する瞬間

```
ユーザーが記事を完了
    ↓
システムが称号条件をチェック
    ↓
条件を満たした場合 → 称号獲得！
    ↓
【演出】重要度に応じてトースト or モーダル表示
```

##### 気になるので意見を聞きたい

> システムが称号条件をチェック
> これをやるとけっこうロード時間がかかってしまったりしますか？時間がかかってもっさりしたサイトになるのは嫌です。

#### 演出パターン

| 重要度 | 演出                     | いつ使う？           |
| ------ | ------------------------ | -------------------- |
| **低** | トースト通知             | 小さなマイルストーン |
| **中** | モーダル（5 秒で閉じる） | 中程度の達成         |
| **高** | モーダル + 紙吹雪        | 大きな達成           |

---

### 2. 獲得した称号を見る

**マイページ**に「獲得した称号」セクションを追加。

```
┌─────────────────────────────────────┐
│  マイページ                          │
├─────────────────────────────────────┤
│                                     │
│  📊 学習の進捗                       │
│  ├─ 完了した記事: 23                │
│  └─ 完了したレッスン: 2              │
│                                     │
│  🏆 獲得した称号                     │
│  ┌─────┐ ┌─────┐ ┌─────┐          │
│  │ 🥉  │ │ 🥈  │ │ 🔒  │          │
│  │第一歩│ │10記事│ │ ?? │          │
│  └─────┘ └─────┘ └─────┘          │
│                                     │
└─────────────────────────────────────┘
```

**検討ポイント**:

- [ ] 未獲得の称号を「🔒」で表示する？→ 一旦しない
- [ ] 獲得日時を表示する？→ イエス
- [ ] 称号をクリックしたら詳細を見れる？→ 見れるようにゆくゆくはしたいです。

---

### 3. プロフィールでの表示

将来的にプロフィール機能ができた際、獲得称号を表示。

##### 気になるのでメモを加えた

**検討ポイント**:

- [ ] 「お気に入り称号」を選んで表示する機能は必要？→ 簡単に作れて複雑にならなければ最初に欲しい
- [ ] 他ユーザーに公開する？→ ゆくゆくできるようにしたい

* 最初の称号実装をするなら一番簡単にできる実装内容を検討しないといけません
* 最初は将来的な機能開発に必要なのであなたに聞いて整備してもらっただけです。正直今実装する優先度は低いです。

---

## 称号の種類（案）

### Phase 1: MVP（最初にリリース）

| ID              | 名前             | 条件                | 重要度 |
| --------------- | ---------------- | ------------------- | ------ |
| `first-article` | 第一歩           | 記事を 1 つ完了     | 低     |
| `articles-5`    | 5 記事達成       | 記事を 5 つ完了     | 低     |
| `articles-10`   | 10 記事マスター  | 記事を 10 個完了    | 中     |
| `articles-25`   | 25 記事制覇      | 記事を 25 個完了    | 中     |
| `articles-50`   | 50 記事の達人    | 記事を 50 個完了    | 高     |
| `first-lesson`  | 初レッスンクリア | レッスンを 1 つ完了 | 中     |
| `lessons-3`     | 3 レッスン突破   | レッスンを 3 つ完了 | 高     |

**検討ポイント**:

- [ ] 称号の名前はこれで OK？
- [ ] 数字の区切り（5, 10, 25, 50）は適切？
- [ ] 他に追加したい称号は？

#### 意見メモ共有

- 称号を考えないといけないのでまだ MVP のものも決めなくていいです！
- 実装ができる余地がある状態にだけしておいてほしいだけです
- 実装しなくていいです。将来的に DB の構造が問題ないかどうかだけを今は確認したいです。

---

### Phase 2: 特定コンテンツ系（将来）

| ID                       | 名前                 | 条件                 | 重要度 |
| ------------------------ | -------------------- | -------------------- | ------ |
| `lesson-{slug}-complete` | {レッスン名}マスター | 特定のレッスンを完了 | 高     |

例:

- 「センスを盗む技術」を完了 → 「センス泥棒」
- 「UI 上達サイクル」を完了 → 「UI サイクルマスター」

**検討ポイント**:

- [ ] 各レッスンに称号を設定する？
- [ ] 称号名はレッスンごとに個別に決める？

---

### Phase 3: コース/ロードマップ系（将来）

※ Sanity CMS に Course 概念を追加後

| ID                    | 名前                | 条件                         | 重要度 |
| --------------------- | ------------------- | ---------------------------- | ------ |
| `course-beginner`     | 初心者コース修了    | 初心者コースの全レッスン完了 | 高     |
| `roadmap-ui-designer` | UI デザイナーへの道 | UI ロードマップ完走          | 高     |

---

## 称号獲得時のメッセージ（案）

### 重要度: 低（トースト）

```
タイトル: 称号ゲット！🎖️
説明: 「第一歩」を獲得したよ！
```

### 重要度: 中（モーダル）

```
┌─────────────────────────────────┐
│            🏅                   │
│                                │
│     称号を獲得しました！         │
│                                │
│    「10記事マスター」            │
│                                │
│  10記事を完了した証だよ！        │
│  この調子で続けよう！            │
│                                │
│        [閉じる]                 │
└─────────────────────────────────┘
```

### 重要度: 高（モーダル + 紙吹雪）

```
┌─────────────────────────────────┐
│        🎊  🏆  🎊               │
│                                │
│     すごい称号を獲得！           │
│                                │
│    「50記事の達人」              │
│                                │
│  50記事完了は本当にすごい！      │
│  めっちゃええやん！最高！        │
│                                │
│        [閉じる]                 │
└─────────────────────────────────┘
```

**検討ポイント**:

- [ ] メッセージのトーンはこれで OK？（セレブレーションと統一）
- [ ] 称号ごとに個別メッセージを設定する？

---

## 技術仕様（概要）

### データベース

```sql
-- ユーザーの獲得済み称号
CREATE TABLE user_badges (
  user_id UUID REFERENCES auth.users(id),
  badge_id TEXT,              -- 称号ID
  earned_at TIMESTAMPTZ,      -- 獲得日時
  PRIMARY KEY (user_id, badge_id)
);
```

### 称号定義（コード側）

```typescript
interface Badge {
  id: string; // 一意のID
  name: string; // 表示名
  description: string; // 説明文
  importance: "low" | "medium" | "high";
  icon?: string; // アイコン（絵文字 or 画像）
  condition: (stats: UserStats) => boolean;
}
```

### 判定タイミング

1. **記事完了時**: `ArticleDetail.tsx` で既存のセレブレーション後にチェック
2. **レッスン完了時**: 同上
3. **ページ読み込み時**: 未獲得の称号を取りこぼしていないかチェック（オプション）

---

## 実装フェーズ（案）

### Phase 1: 基盤実装

- [ ] `user_badges` テーブル作成
- [ ] 称号定義ファイル作成
- [ ] 称号チェックロジック実装
- [ ] 獲得時の演出実装（トースト/モーダル）

### Phase 2: 表示機能

- [ ] マイページに「獲得した称号」セクション追加
- [ ] 称号一覧コンポーネント作成

### Phase 3: 拡張

- [ ] 特定レッスン完了称号の追加
- [ ] コース/ロードマップ称号（Sanity 変更後）

---

## 未決定事項

以下の項目について相談が必要です：

1. **称号の名前とデザイン**

   - 現在の案で OK か
   - アイコンは絵文字でいいか、独自デザインにするか

2. **未獲得称号の表示**

   - 「次の目標」として見せるか、完全に隠すか

3. **獲得済み称号の詳細**

   - クリックして詳細を見れるようにするか
   - 獲得日時を表示するか

4. **演出のタイミング**

   - 記事完了 → セレブレーション → 称号演出 の順番で OK か
   - 同時に複数獲得した場合の挙動

5. **特定レッスン称号**
   - どのレッスンに称号を設定するか
   - 称号名をどう決めるか

---

## 次のアクション

1. この仕様書の内容を確認
2. 検討ポイントについて相談
3. 仕様確定後、実装開始

---

## 更新履歴

| 日付       | 内容     |
| ---------- | -------- |
| 2025-12-19 | 初版作成 |
