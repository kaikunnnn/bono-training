# サブスクリプション UX問題トラッカー

**最終更新**: 2025-12-02

---

## 📑 目次

- [🎯 このドキュメントの目的](#-このドキュメントの目的)
- [🔴 Critical（高優先度）](#-critical高優先度)
- [🟡 Medium（中優先度）](#-medium中優先度)
  - [[ISSUE-103] 3ヶ月プランの金額表示が誤解を招く](#issue-103-3ヶ月プランの金額表示が誤解を招く)
  - [[ISSUE-101] プラン変更時の確認ダイアログがない](#issue-101-プラン変更時の確認ダイアログがない)
  - [[ISSUE-102] 料金表示が分かりにくい](#issue-102-料金表示が分かりにくい)
- [🟢 Low（低優先度）](#-low低優先度)
  - [[ISSUE-203] プラン変更成功画面に期間が表示されない](#issue-203-プラン変更成功画面に期間が表示されない)
  - [[ISSUE-204] /subscriptionページでキャンセル状態が表示されない](#issue-204-subscriptionページでキャンセル状態が表示されない)
  - [[ISSUE-201] プラン変更時のローディング状態が不明確](#issue-201-プラン変更時のローディング状態が不明確)
  - [[ISSUE-202] 次回更新日が表示されない](#issue-202-次回更新日が表示されない)
- [✅ 解決済み](#-解決済み)
  - [[ISSUE-303] プラン変更時に二重課金が発生する](#issue-303-プラン変更時に二重課金が発生する-解決済み)
  - [[ISSUE-304] 決済完了後、画面が更新されない](#issue-304-決済完了後画面が更新されない-解決済み)
  - [[ISSUE-301] ブラウザバックで既存プランが解除される](#issue-301-ブラウザバックで既存プランが解除される-解決済み)
  - [[ISSUE-302] Webhook環境変数バグ](#issue-302-webhook環境変数バグ-解決済み)
- [📝 Issue追加テンプレート](#-issue追加テンプレート)
- [🎯 Issue番号の採番ルール](#-issue番号の採番ルール)
- [📊 Issue統計](#-issue統計)

---

## 🎯 このドキュメントの目的

実際に使っていて「これ変だな」「使いにくい」と感じた問題を記録する。

**使い方**:
1. 問題を発見したらすぐに追加
2. 深刻度を記載（🔴 高 / 🟡 中 / 🟢 低）
3. Claude Codeが修正したら「✅ 解決済み」に移動

---

## 🔴 Critical（高優先度）

現在 Critical な問題はありません。

---

## 🟡 Medium（中優先度）

### [ISSUE-103] 3ヶ月プランの金額表示が誤解を招く

**深刻度**: 🟡 中
**発生日**: 2025-12-02
**ステータス**: 📋 未対応

**問題**:
3ヶ月プランの料金表示で「17,400円/月」と表示されているが、これは3ヶ月分の合計金額であり、月あたりの金額ではない。

**再現手順**:
1. `/subscription` ページにアクセス
2. 3ヶ月タブを選択
3. 料金表示を確認 → 「17,400円/月」と表示

**現状の表示**:
```
スタンダード: 17,400円/月（一括 52,200円）
フィードバック: 41,400円/月（一括 124,200円）
```

**期待する表示**:
```
スタンダード: 5,800円/月（3ヶ月一括 17,400円）
フィードバック: 13,800円/月（3ヶ月一括 41,400円）
```

**影響**:
ユーザーが料金を誤解する可能性がある

---

### [ISSUE-101] プラン変更時の確認ダイアログがない

**深刻度**: 🟡 中
**発生日**: 2025-11-XX
**ステータス**: 📋 未対応

**問題**:
「このプランを選択」ボタンをクリックすると、確認なしで即座にCheckoutページに遷移する。
誤クリックした場合、戻るのが面倒。

**再現手順**:
1. /subscriptionページで「フィードバックプランを選択」をクリック
2. 確認なしでStripe Checkoutに遷移

**期待値**:
```
確認ダイアログ例:
「フィードバックプラン (¥4,980/月) に変更しますか？
 現在のスタンダードプランは自動的にキャンセルされます。」

 [キャンセル] [変更する]
```

**優先度**:
中（二重課金問題を解決した後に対応）

---

### [ISSUE-102] 料金表示が分かりにくい

**深刻度**: 🟡 中
**発生日**: 2025-11-XX
**ステータス**: 📋 未対応

**問題**:
プラン一覧で「¥4,989/月」と表示されているが、税込かどうか不明。

**期待値**:
「¥4,989（税込）/月」と明示

---

## 🟢 Low（低優先度）

### [ISSUE-203] プラン変更成功画面に期間が表示されない

**深刻度**: 🟢 低
**発生日**: 2025-12-02
**ステータス**: 📋 未対応

**問題**:
プラン変更完了後の成功画面で、プラン名は表示されるが期間（1ヶ月/3ヶ月）が表示されない。

**現状の表示**:
```
「スタンダードプランへの変更が完了しました」
```

**期待する表示**:
```
「スタンダードプラン（3ヶ月）への変更が完了しました」
```

**影響**:
ユーザーが変更後の期間を即座に確認できない

---

### [ISSUE-204] /subscriptionページでキャンセル状態が表示されない

**深刻度**: 🟢 低
**発生日**: 2025-12-02
**ステータス**: 📋 未対応

**問題**:
サブスクリプションがキャンセル済みの場合、/accountページでは【キャンセル済み】バッジが表示されるが、/subscriptionページでは「現在のプラン」としか表示されない。

**現状の表示**（/subscription）:
```
フィードバック カード: 「現在のプラン」（グレーバッジ）
```

**期待する表示**:
```
フィードバック カード: 「現在のプラン【キャンセル済み】」（オレンジバッジ）
※ /accountページと同じ表示スタイル
```

**影響**:
/subscriptionページでキャンセル状態が分からず、ユーザーが混乱する可能性がある

---

### [ISSUE-201] プラン変更時のローディング状態が不明確

**深刻度**: 🟢 低
**発生日**: 2025-11-XX
**ステータス**: 📋 未対応

**問題**:
「このプランを選択」ボタンをクリックしてから、Checkoutページに遷移するまでの間、何も表示されない。
ボタンが効いたかどうか分からない。

**期待値**:
- ボタンクリック → ローディングスピナー表示
- 「Checkoutページを準備中...」などのメッセージ

---

### [ISSUE-202] 次回更新日が表示されない

**深刻度**: 🟢 低
**発生日**: 2025-11-XX
**ステータス**: 📋 未対応

**問題**:
/subscriptionページに現在のプランは表示されるが、次回更新日が表示されない。
「いつまで使えるか」が分からない。

**期待値**:
```
現在のプラン: フィードバック
次回更新日: 2025-12-29
次回請求額: ¥4,980（税込）
```

---

## ✅ 解決済み

### [ISSUE-303] プラン変更時に二重課金が発生する（✅ 解決済み）

**深刻度**: 🔴 Critical → ✅ 解決済み
**発生日**: 2025-11-29
**解決日**: 2025-12-02

**問題**:
スタンダード → フィードバックにプラン変更したところ、両方のプランが課金されていた。

**解決方法**:
サブスクリプションシステム全体を再構築。プラン変更時に既存サブスクリプションを適切に更新する仕組みを実装。

**関連ドキュメント**:
- [サブスクリプション再構築プロジェクト](../redesign/MASTER-PLAN.md)

---

### [ISSUE-304] 決済完了後、画面が更新されない（✅ 解決済み）

**深刻度**: 🔴 Critical → ✅ 解決済み
**発生日**: 2025-11-29
**解決日**: 2025-12-02

**問題**:
プラン変更完了後、/subscriptionページに戻っても新プランが表示されなかった。

**解決方法**:
Webhook処理とリアルタイム状態更新を再実装。成功ページからの遷移フローを改善。

**関連ドキュメント**:
- [サブスクリプション再構築プロジェクト](../redesign/MASTER-PLAN.md)
- [本番環境検証](../redesign/testing/2025-12-02-production-verification.md)

---

### [ISSUE-301] ブラウザバックで既存プランが解除される（✅ 解決済み）

**深刻度**: 🔴 Critical → ✅ 解決済み
**発生日**: 2025-11-28
**解決日**: 2025-11-28

**問題**:
Stripe Checkoutページで「戻る」ボタンを押すと、既存のプランが解除されてしまう。

**解決方法**:
Checkoutセッション作成時に `cancel_url` を設定し、既存プランの状態を保持するように修正。

**関連ドキュメント**:
- [ブラウザバックバグ分析](../../archive/issues/browser-back-bug-analysis.md)

---

### [ISSUE-302] Webhook環境変数バグ（✅ 解決済み）

**深刻度**: 🔴 Critical → ✅ 解決済み
**発生日**: 2025-11-28
**解決日**: 2025-11-28

**問題**:
本番環境とテスト環境のWebhook Secretが混在して、署名検証が失敗していた。

**解決方法**:
`STRIPE_WEBHOOK_SECRET_TEST` と `STRIPE_WEBHOOK_SECRET_LIVE` を明示的に分離。

**関連ドキュメント**:
- [Webhook環境変数バグ](../../archive/issues/2025-11-28-webhook-environment-bug.md)

---

## 📝 Issue追加テンプレート

新しいIssueを追加する時は、以下のフォーマットを使用してください：

```markdown
### [ISSUE-XXX] [問題タイトル]

**深刻度**: 🔴 高 / 🟡 中 / 🟢 低
**発生日**: YYYY-MM-DD
**ステータス**: 📋 未対応 / 🔧 修正中 / ✅ 解決済み

**問題**:
何が起きているか、具体的に記述


**再現手順**:
1. 
2. 
3. 

**期待値**:
どうあるべきか


**優先度**:
なぜこの深刻度か


**関連ドキュメント**:
- [リンク](path/to/doc.md)
```

---

## 🎯 Issue番号の採番ルール

| 範囲 | 深刻度 |
|------|--------|
| 001-099 | 🔴 Critical |
| 101-199 | 🟡 Medium |
| 201-299 | 🟢 Low |
| 301-399 | ✅ 解決済み |

---

## 📊 Issue統計

**全体**:
- 🔴 Critical: 0件
- 🟡 Medium: 3件（未対応）
- 🟢 Low: 4件（未対応）
- ✅ 解決済み: 4件

**最優先**: [ISSUE-103] 3ヶ月プランの金額表示

---

**UX問題を放置せず、すぐに記録・修正することで、ユーザー体験を改善できます。**
