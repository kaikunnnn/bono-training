# ãƒ‡ãƒ¼ã‚¿ç§»è¡Œ - æ¬¡ã®ã‚¹ãƒ†ãƒƒãƒ—

**ä½œæˆæ—¥**: 2025-11-19
**ç¾åœ¨ã®çŠ¶æ³**: ãƒ‡ãƒ¼ã‚¿åé›†å®Œäº†ã€å®Ÿè£…æº–å‚™æ®µéš

---

## ğŸ“Š ç¾çŠ¶ã¾ã¨ã‚

### åé›†æ¸ˆã¿ãƒ‡ãƒ¼ã‚¿

âœ… **Supabase ãƒ†ãƒ¼ãƒ–ãƒ«çŠ¶æ³**

- `stripe_customers`: 8 ä»¶ï¼ˆãƒ†ã‚¹ãƒˆãƒ‡ãƒ¼ã‚¿ï¼‰
- `user_subscriptions`: 1 ä»¶ï¼ˆãƒ†ã‚¹ãƒˆãƒ‡ãƒ¼ã‚¿ï¼‰
- `subscriptions`: 7 ä»¶ï¼ˆãƒ†ã‚¹ãƒˆãƒ‡ãƒ¼ã‚¿ï¼‰

âœ… **Stripe é¡§å®¢ã‚µãƒ³ãƒ—ãƒ«**

- é¡§å®¢ 1: æ˜¥å¥ˆ å®®åœ° (harunaru888@gmail.com) - Â¥17,400ï¼ˆ3 ãƒ¶æœˆãƒ—ãƒ©ãƒ³ï¼‰
- é¡§å®¢ 2: Tanology (amiried@icloud.com) - Â¥6,800/æœˆ

âœ… **æ—¢å­˜ãƒ—ãƒ©ãƒ³æƒ…å ±**

- Standard 1 ãƒ¶æœˆ: Â¥6,800/æœˆ (price_1RStBiKUVUnt8GtynMfKweby)
- Standard 3 ãƒ¶æœˆ: Â¥5,800/æœˆ (price_1RStCiKUVUnt8GtyKJiieo6d)
- Feedback 1 ãƒ¶æœˆ: Â¥1,480/æœˆ (price_1OIiMRKUVUnt8GtyMGSJIH8H)
- Feedback 3 ãƒ¶æœˆ: Â¥1,280/æœˆ (price_1OIiMRKUVUnt8GtyttXJ71Hz)

âœ… **ç§»è¡Œè¦æ¨¡**

- ç·é¡§å®¢æ•°: 2,162 äºº
- ã‚¢ã‚¯ãƒ†ã‚£ãƒ–ã‚µãƒ–ã‚¹ã‚¯ãƒªãƒ—ã‚·ãƒ§ãƒ³: 250 ä»¶

---

## âš ï¸ ç™ºè¦‹ã•ã‚ŒãŸé‡è¦ãªå•é¡Œ

### 1. ä¾¡æ ¼ã®ä¸ä¸€è‡´

| ãƒ—ãƒ©ãƒ³          | æ—¢å­˜é¡§å®¢ï¼ˆæœ¬ç•ªï¼‰ | ãƒ†ã‚¹ãƒˆå®Ÿè£… | å·®é¡    |
| --------------- | ---------------- | ---------- | ------- |
| Standard 1 ãƒ¶æœˆ | Â¥6,800/æœˆ        | Â¥4,000/æœˆ  | -Â¥2,800 |
| Standard 3 ãƒ¶æœˆ | Â¥5,800/æœˆ        | Â¥3,800/æœˆ  | -Â¥2,000 |

**å½±éŸ¿**:

- æ—¢å­˜é¡§å®¢ã‚’æ–° Price ID ã«ç§»è¡Œã™ã‚‹ã¨å¤§å¹…ãªå€¤ä¸‹ã’ã«ãªã‚‹
- æ—¢å­˜ã‚µãƒ–ã‚¹ã‚¯ãƒªãƒ—ã‚·ãƒ§ãƒ³ ID ã‚’ç¶­æŒã™ã‚Œã°ä¾¡æ ¼ã¯å¤‰ã‚ã‚‰ãªã„

**æ¨å¥¨å¯¾å¿œ**: æ—¢å­˜é¡§å®¢ã¯æ—¢å­˜ Price ID ã‚’ç¶­æŒï¼ˆç§»è¡Œä¸è¦ï¼‰

---

### 2. MemberStack ãƒ¡ã‚¿ãƒ‡ãƒ¼ã‚¿

å…¨é¡§å®¢ã«ä»¥ä¸‹ã®ãƒ¡ã‚¿ãƒ‡ãƒ¼ã‚¿ãŒä»˜ä¸ã•ã‚Œã¦ã„ã‚‹:

```json
{
  "msAppId": "app_cl9jkke7100ij0vkwg01c7s4v",
  "msMemberId": "mem_xxxxx"
}
```

**æ¨å¥¨å¯¾å¿œ**: ãƒ¡ã‚¿ãƒ‡ãƒ¼ã‚¿ã‚’ä¿æŒã—ã¦ç§»è¡Œï¼ˆå°†æ¥ã®å‚ç…§ç”¨ï¼‰

---

## ğŸ¯ å®Ÿè£…æ–¹é‡ï¼ˆç¢ºå®šç‰ˆï¼‰

### åŸºæœ¬æˆ¦ç•¥

**æ—¢å­˜ã® Stripe ã‚µãƒ–ã‚¹ã‚¯ãƒªãƒ—ã‚·ãƒ§ãƒ³ ID ã‚’å®Œå…¨ã«ç¶­æŒã™ã‚‹æ–¹å¼**

ç†ç”±:

1. âœ… ä¾¡æ ¼å¤‰æ›´ãªã—ï¼ˆæ—¢å­˜é¡§å®¢ã«å½±éŸ¿ã‚¼ãƒ­ï¼‰
2. âœ… èª²é‡‘ç¶™ç¶šï¼ˆãƒªã‚¹ã‚¯ãªã—ï¼‰
3. âœ… Stripe Webhook ãŒãã®ã¾ã¾å‹•ä½œ
4. âœ… ãƒ­ãƒ¼ãƒ«ãƒãƒƒã‚¯ãŒå®¹æ˜“

---

## ğŸ“‹ å®Ÿè£…æ‰‹é †ï¼ˆè©³ç´°ç‰ˆï¼‰

### Phase 1: æº–å‚™ä½œæ¥­ï¼ˆ1 æ—¥ï¼‰

#### Step 1-1: Supabase ãƒ†ã‚¹ãƒˆãƒ‡ãƒ¼ã‚¿ã®ã‚¯ãƒªã‚¢

```sql
-- å®Ÿè¡Œå‰ã«ç¢ºèª
SELECT COUNT(*) FROM stripe_customers;  -- 8ä»¶
SELECT COUNT(*) FROM user_subscriptions; -- 1ä»¶
SELECT COUNT(*) FROM subscriptions;      -- 7ä»¶

-- ãƒ†ã‚¹ãƒˆãƒ‡ãƒ¼ã‚¿ã‚’å‰Šé™¤
DELETE FROM subscriptions;
DELETE FROM user_subscriptions;
DELETE FROM stripe_customers;

-- ç¢ºèªï¼ˆå…¨ã¦0ä»¶ã«ãªã£ã¦ã„ã‚‹ã“ã¨ï¼‰
SELECT COUNT(*) FROM stripe_customers;
SELECT COUNT(*) FROM user_subscriptions;
SELECT COUNT(*) FROM subscriptions;
```

#### Step 1-2: Stripe ãƒ‡ãƒ¼ã‚¿ã®ã‚¨ã‚¯ã‚¹ãƒãƒ¼ãƒˆ

**æ–¹æ³•**: Stripe Dashboard â†’ ãƒ‡ãƒ¼ã‚¿ã‚¨ã‚¯ã‚¹ãƒãƒ¼ãƒˆ

å¿…è¦ãªãƒ‡ãƒ¼ã‚¿:

1. **é¡§å®¢ãƒ‡ãƒ¼ã‚¿** (Customers)

   - Email
   - Customer ID
   - Created date
   - Metadata

2. **ã‚µãƒ–ã‚¹ã‚¯ãƒªãƒ—ã‚·ãƒ§ãƒ³ãƒ‡ãƒ¼ã‚¿** (Subscriptions)
   - Subscription ID
   - Customer ID
   - Status (active, canceled, trialing, etc.)
   - Current period end
   - Cancel at period end
   - Price ID
   - Created date

**ã‚¨ã‚¯ã‚¹ãƒãƒ¼ãƒˆæ‰‹é †**:

```
1. https://dashboard.stripe.com ã«ãƒ­ã‚°ã‚¤ãƒ³
2. å¿…ãšæœ¬ç•ªãƒ¢ãƒ¼ãƒ‰ï¼ˆLive modeï¼‰ã«åˆ‡ã‚Šæ›¿ãˆ
3. å·¦ãƒ¡ãƒ‹ãƒ¥ãƒ¼ã€Œé¡§å®¢ã€â†’ å³ä¸Šã€Œã‚¨ã‚¯ã‚¹ãƒãƒ¼ãƒˆã€â†’ CSV
4. å·¦ãƒ¡ãƒ‹ãƒ¥ãƒ¼ã€Œã‚µãƒ–ã‚¹ã‚¯ãƒªãƒ—ã‚·ãƒ§ãƒ³ã€â†’ å³ä¸Šã€Œã‚¨ã‚¯ã‚¹ãƒãƒ¼ãƒˆã€â†’ CSV
5. ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰ã—ãŸCSVã‚’ç¢ºèª
```

#### Step 1-3: ãƒ‡ãƒ¼ã‚¿ã®æ¤œè¨¼

ã‚¨ã‚¯ã‚¹ãƒãƒ¼ãƒˆã—ãŸ CSV ã‚’ç¢ºèª:

- é¡§å®¢æ•°ãŒ 2,162 ä»¶å‰å¾Œã‹
- ã‚¢ã‚¯ãƒ†ã‚£ãƒ–ãªã‚µãƒ–ã‚¹ã‚¯ãƒªãƒ—ã‚·ãƒ§ãƒ³ãŒ 250 ä»¶å‰å¾Œã‹
- ãƒ¡ãƒ¼ãƒ«ã‚¢ãƒ‰ãƒ¬ã‚¹ãŒå…¨ã¦å«ã¾ã‚Œã¦ã„ã‚‹ã‹

---

### Phase 2: ç§»è¡Œã‚¹ã‚¯ãƒªãƒ—ãƒˆã®ä½œæˆï¼ˆ2-3 æ—¥ï¼‰

#### Script 1: Supabase Auth ãƒ¦ãƒ¼ã‚¶ãƒ¼ä½œæˆ

```typescript
// scripts/migrate-create-auth-users.ts
import { createClient } from "@supabase/supabase-js";
import { parse } from "csv-parse/sync";
import * as fs from "fs";

const supabaseUrl = process.env.NEXT_PUBLIC_SUPABASE_URL!;
const supabaseServiceKey = process.env.SUPABASE_SERVICE_ROLE_KEY!;

const supabase = createClient(supabaseUrl, supabaseServiceKey, {
  auth: {
    autoRefreshToken: false,
    persistSession: false,
  },
});

interface StripeCustomer {
  id: string; // Stripe Customer ID
  email: string;
  created: string;
  metadata_msAppId?: string;
  metadata_msMemberId?: string;
}

async function createAuthUsers() {
  // CSVã‚’èª­ã¿è¾¼ã¿
  const csvContent = fs.readFileSync("./stripe-customers.csv", "utf-8");
  const customers: StripeCustomer[] = parse(csvContent, {
    columns: true,
    skip_empty_lines: true,
  });

  console.log(`Total customers to migrate: ${customers.length}`);

  let successCount = 0;
  let errorCount = 0;
  const errors: Array<{ email: string; error: string }> = [];

  // ãƒãƒƒãƒå‡¦ç†ï¼ˆ50ä»¶ãšã¤ï¼‰
  for (let i = 0; i < customers.length; i += 50) {
    const batch = customers.slice(i, i + 50);

    await Promise.all(
      batch.map(async (customer) => {
        try {
          // Supabase Authãƒ¦ãƒ¼ã‚¶ãƒ¼ã‚’ä½œæˆ
          const { data: authData, error: authError } =
            await supabase.auth.admin.createUser({
              email: customer.email,
              email_confirm: true, // ãƒ¡ãƒ¼ãƒ«ç¢ºèªæ¸ˆã¿ã¨ã™ã‚‹
              user_metadata: {
                stripe_customer_id: customer.id,
                memberstack_app_id: customer.metadata_msAppId,
                memberstack_member_id: customer.metadata_msMemberId,
                migrated_from: "stripe",
                migrated_at: new Date().toISOString(),
              },
            });

          if (authError) {
            throw authError;
          }

          console.log(
            `âœ… Created user: ${customer.email} (${authData.user.id})`
          );
          successCount++;
        } catch (error: any) {
          console.error(
            `âŒ Failed to create user: ${customer.email}`,
            error.message
          );
          errors.push({ email: customer.email, error: error.message });
          errorCount++;
        }
      })
    );

    // ãƒ¬ãƒ¼ãƒˆåˆ¶é™å¯¾ç­–ï¼ˆ1ç§’å¾…æ©Ÿï¼‰
    if (i + 50 < customers.length) {
      await new Promise((resolve) => setTimeout(resolve, 1000));
    }
  }

  // çµæœã‚µãƒãƒªãƒ¼
  console.log("\n========================================");
  console.log("Migration Summary");
  console.log("========================================");
  console.log(`Total: ${customers.length}`);
  console.log(`Success: ${successCount}`);
  console.log(`Error: ${errorCount}`);

  if (errors.length > 0) {
    console.log("\nErrors:");
    errors.forEach((e) => {
      console.log(`  - ${e.email}: ${e.error}`);
    });

    // ã‚¨ãƒ©ãƒ¼ãƒ­ã‚°ã‚’ãƒ•ã‚¡ã‚¤ãƒ«ã«ä¿å­˜
    fs.writeFileSync(
      "./migration-errors-auth.json",
      JSON.stringify(errors, null, 2)
    );
  }
}

createAuthUsers().catch(console.error);
```

#### Script 2: stripe_customers ãƒ†ãƒ¼ãƒ–ãƒ«ã®åŒæœŸ

```typescript
// scripts/migrate-stripe-customers.ts
import { createClient } from "@supabase/supabase-js";
import { parse } from "csv-parse/sync";
import * as fs from "fs";

const supabaseUrl = process.env.NEXT_PUBLIC_SUPABASE_URL!;
const supabaseServiceKey = process.env.SUPABASE_SERVICE_ROLE_KEY!;

const supabase = createClient(supabaseUrl, supabaseServiceKey);

interface StripeCustomer {
  id: string;
  email: string;
}

async function migrateStripeCustomers() {
  const csvContent = fs.readFileSync("./stripe-customers.csv", "utf-8");
  const customers: StripeCustomer[] = parse(csvContent, {
    columns: true,
    skip_empty_lines: true,
  });

  console.log(`Total customers to sync: ${customers.length}`);

  let successCount = 0;
  let errorCount = 0;

  for (const customer of customers) {
    try {
      // ãƒ¡ãƒ¼ãƒ«ã‚¢ãƒ‰ãƒ¬ã‚¹ã‹ã‚‰Supabase Authã®ãƒ¦ãƒ¼ã‚¶ãƒ¼IDã‚’å–å¾—
      const { data: users, error: getUserError } =
        await supabase.auth.admin.listUsers();

      if (getUserError) throw getUserError;

      const user = users.users.find((u) => u.email === customer.email);

      if (!user) {
        throw new Error(`User not found for email: ${customer.email}`);
      }

      // stripe_customersãƒ†ãƒ¼ãƒ–ãƒ«ã«upsert
      const { error: insertError } = await supabase
        .from("stripe_customers")
        .upsert({
          user_id: user.id,
          stripe_customer_id: customer.id,
          created_at: new Date().toISOString(),
          updated_at: new Date().toISOString(),
        });

      if (insertError) throw insertError;

      console.log(`âœ… Synced: ${customer.email} â†’ ${customer.id}`);
      successCount++;
    } catch (error: any) {
      console.error(`âŒ Failed: ${customer.email}`, error.message);
      errorCount++;
    }
  }

  console.log("\n========================================");
  console.log(`Success: ${successCount} / ${customers.length}`);
  console.log(`Error: ${errorCount}`);
  console.log("========================================");
}

migrateStripeCustomers().catch(console.error);
```

#### Script 3: user_subscriptions ãƒ†ãƒ¼ãƒ–ãƒ«ã®åŒæœŸ

```typescript
// scripts/migrate-subscriptions.ts
import { createClient } from "@supabase/supabase-js";
import { parse } from "csv-parse/sync";
import * as fs from "fs";

const supabaseUrl = process.env.NEXT_PUBLIC_SUPABASE_URL!;
const supabaseServiceKey = process.env.SUPABASE_SERVICE_ROLE_KEY!;

const supabase = createClient(supabaseUrl, supabaseServiceKey);

interface StripeSubscription {
  id: string; // Subscription ID
  customer: string; // Customer ID
  status: string;
  current_period_end: string;
  cancel_at_period_end: string;
  price: string; // Price ID
}

// Price IDã‹ã‚‰ãƒ—ãƒ©ãƒ³æƒ…å ±ã‚’åˆ¤å®š
function getPlanInfo(priceId: string) {
  const planMap: Record<string, { planType: string; duration: number }> = {
    price_1RStBiKUVUnt8GtynMfKweby: { planType: "standard", duration: 1 },
    price_1RStCiKUVUnt8GtyKJiieo6d: { planType: "standard", duration: 3 },
    price_1OIiMRKUVUnt8GtyMGSJIH8H: { planType: "feedback", duration: 1 },
    price_1OIiMRKUVUnt8GtyttXJ71Hz: { planType: "feedback", duration: 3 },
  };

  return planMap[priceId] || { planType: "standard", duration: 1 };
}

async function migrateSubscriptions() {
  const csvContent = fs.readFileSync("./stripe-subscriptions.csv", "utf-8");
  const subscriptions: StripeSubscription[] = parse(csvContent, {
    columns: true,
    skip_empty_lines: true,
  });

  console.log(`Total subscriptions to migrate: ${subscriptions.length}`);

  let successCount = 0;
  let errorCount = 0;

  for (const sub of subscriptions) {
    try {
      // stripe_customersãƒ†ãƒ¼ãƒ–ãƒ«ã‹ã‚‰user_idã‚’å–å¾—
      const { data: customerData, error: getCustomerError } = await supabase
        .from("stripe_customers")
        .select("user_id")
        .eq("stripe_customer_id", sub.customer)
        .single();

      if (getCustomerError || !customerData) {
        throw new Error(`Customer not found: ${sub.customer}`);
      }

      const planInfo = getPlanInfo(sub.price);
      const isActive = sub.status === "active" || sub.status === "trialing";
      const cancelAtPeriodEnd = sub.cancel_at_period_end === "true";

      // user_subscriptionsãƒ†ãƒ¼ãƒ–ãƒ«ã«upsert
      const { error: insertError } = await supabase
        .from("user_subscriptions")
        .upsert({
          user_id: customerData.user_id,
          stripe_subscription_id: sub.id,
          stripe_customer_id: sub.customer,
          plan_type: planInfo.planType,
          duration: planInfo.duration,
          is_active: isActive,
          plan_members: planInfo.planType === "standard", // Standardãƒ—ãƒ©ãƒ³ã®ã¿true
          cancel_at_period_end: cancelAtPeriodEnd,
          current_period_end: new Date(
            parseInt(sub.current_period_end) * 1000
          ).toISOString(),
          created_at: new Date().toISOString(),
          updated_at: new Date().toISOString(),
        });

      if (insertError) throw insertError;

      console.log(`âœ… Migrated subscription: ${sub.id} (${sub.status})`);
      successCount++;
    } catch (error: any) {
      console.error(`âŒ Failed: ${sub.id}`, error.message);
      errorCount++;
    }
  }

  console.log("\n========================================");
  console.log(`Success: ${successCount} / ${subscriptions.length}`);
  console.log(`Error: ${errorCount}`);
  console.log("========================================");
}

migrateSubscriptions().catch(console.error);
```

---

### Phase 3: ãƒ†ã‚¹ãƒˆå®Ÿè¡Œï¼ˆ1 æ—¥ï¼‰

#### Test 1: ã‚µãƒ³ãƒ—ãƒ«ãƒ‡ãƒ¼ã‚¿ã§ã®ãƒ†ã‚¹ãƒˆ

1. 10 ä»¶ã®ã‚µãƒ³ãƒ—ãƒ«ãƒ‡ãƒ¼ã‚¿ã§ç§»è¡Œãƒ†ã‚¹ãƒˆ
2. ãƒ‡ãƒ¼ã‚¿ã®æ•´åˆæ€§ç¢ºèª
3. ã‚¨ãƒ©ãƒ¼ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°ã®ç¢ºèª

#### Test 2: å…¨ãƒ‡ãƒ¼ã‚¿ç§»è¡Œï¼ˆæœ¬ç•ªï¼‰

1. ä¸Šè¨˜ã‚¹ã‚¯ãƒªãƒ—ãƒˆã‚’é †ç•ªã«å®Ÿè¡Œ
2. ã‚¨ãƒ©ãƒ¼ãƒ­ã‚°ã‚’ç¢ºèª
3. ãƒ‡ãƒ¼ã‚¿ä»¶æ•°ã‚’ç¢ºèª

```sql
-- ç§»è¡Œå¾Œã®ç¢ºèª
SELECT COUNT(*) FROM stripe_customers;      -- 2,162ä»¶å‰å¾Œ
SELECT COUNT(*) FROM user_subscriptions;    -- 250ä»¶å‰å¾Œï¼ˆã‚¢ã‚¯ãƒ†ã‚£ãƒ–ã®ã¿ï¼‰
SELECT COUNT(*) FROM auth.users;            -- 2,162ä»¶å‰å¾Œ

-- ãƒ‡ãƒ¼ã‚¿ã®æ•´åˆæ€§ç¢ºèª
SELECT
  u.email,
  sc.stripe_customer_id,
  us.plan_type,
  us.duration,
  us.is_active
FROM auth.users u
LEFT JOIN stripe_customers sc ON u.id = sc.user_id
LEFT JOIN user_subscriptions us ON u.id = us.user_id
LIMIT 10;
```

---

### Phase 4: ä¸¦è¡Œç¨¼åƒãƒ†ã‚¹ãƒˆï¼ˆ1-2 é€±é–“ï¼‰

#### æ—¢å­˜ã‚µã‚¤ãƒˆ

- ãã®ã¾ã¾ç¨¼åƒ
- MemberStack + Stripe

#### æ–°ã‚µã‚¤ãƒˆ

- Supabase + Stripe
- åŒã˜ Stripe ã‚¢ã‚«ã‚¦ãƒ³ãƒˆ
- Webhook ã§è‡ªå‹•åŒæœŸ

#### ç¢ºèªäº‹é …

- [ ] æ—¢å­˜é¡§å®¢ãŒæ–°ã‚µã‚¤ãƒˆã§ãƒ­ã‚°ã‚¤ãƒ³ã§ãã‚‹
- [ ] ã‚µãƒ–ã‚¹ã‚¯ãƒªãƒ—ã‚·ãƒ§ãƒ³æƒ…å ±ãŒæ­£ã—ãè¡¨ç¤ºã•ã‚Œã‚‹
- [ ] Webhook ãŒæ­£å¸¸ã«å‹•ä½œã™ã‚‹
- [ ] èª²é‡‘ãŒç¶™ç¶šã•ã‚Œã‚‹
- [ ] ã‚­ãƒ£ãƒ³ã‚»ãƒ«æ¸ˆã¿ãƒ¦ãƒ¼ã‚¶ãƒ¼ã®çŠ¶æ…‹ãŒæ­£ã—ã„

---

## ğŸ“ å¿…è¦ãªã‚¢ã‚¯ã‚·ãƒ§ãƒ³

### ã‚ãªãŸãŒã‚„ã‚‹ã“ã¨

#### 1. Stripe ãƒ‡ãƒ¼ã‚¿ã®ã‚¨ã‚¯ã‚¹ãƒãƒ¼ãƒˆï¼ˆå¿…é ˆï¼‰

ä»¥ä¸‹ã®æ‰‹é †ã§ CSV ã‚’ã‚¨ã‚¯ã‚¹ãƒãƒ¼ãƒˆ:

```
ã€é¡§å®¢ãƒ‡ãƒ¼ã‚¿ã€‘
1. https://dashboard.stripe.com ã«ãƒ­ã‚°ã‚¤ãƒ³
2. å³ä¸Šã®ãƒˆã‚°ãƒ«ã§ã€Œæœ¬ç•ªãƒ¢ãƒ¼ãƒ‰ã€ã«åˆ‡ã‚Šæ›¿ãˆ
3. å·¦ãƒ¡ãƒ‹ãƒ¥ãƒ¼ã€Œé¡§å®¢ã€â†’ å³ä¸Šã€Œã‚¨ã‚¯ã‚¹ãƒãƒ¼ãƒˆã€
4. å…¨ãƒ‡ãƒ¼ã‚¿ã‚’é¸æŠ â†’ CSVå½¢å¼ã§ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰
5. ãƒ•ã‚¡ã‚¤ãƒ«åã‚’ stripe-customers.csv ã«ãƒªãƒãƒ¼ãƒ 

ã€ã‚µãƒ–ã‚¹ã‚¯ãƒªãƒ—ã‚·ãƒ§ãƒ³ãƒ‡ãƒ¼ã‚¿ã€‘
1. å·¦ãƒ¡ãƒ‹ãƒ¥ãƒ¼ã€Œã‚µãƒ–ã‚¹ã‚¯ãƒªãƒ—ã‚·ãƒ§ãƒ³ã€â†’ å³ä¸Šã€Œã‚¨ã‚¯ã‚¹ãƒãƒ¼ãƒˆã€
2. å…¨ãƒ‡ãƒ¼ã‚¿ã‚’é¸æŠ â†’ CSVå½¢å¼ã§ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰
3. ãƒ•ã‚¡ã‚¤ãƒ«åã‚’ stripe-subscriptions.csv ã«ãƒªãƒãƒ¼ãƒ 
```

#### 2. Supabase Service Role Key ã®å–å¾—ï¼ˆå¿…é ˆï¼‰

```
1. https://supabase.com/dashboard/project/fryogvfhymnpiqwssmuu/settings/api
2. ã€ŒProject API keysã€ã‚»ã‚¯ã‚·ãƒ§ãƒ³
3. service_role ã®ã€ŒRevealã€ã‚’ã‚¯ãƒªãƒƒã‚¯
4. ã‚³ãƒ”ãƒ¼ã—ã¦ .env ã«è¿½åŠ :
   SUPABASE_SERVICE_ROLE_KEY=your_service_role_key
```

#### 3. ãƒ†ã‚¹ãƒˆãƒ‡ãƒ¼ã‚¿ã®ã‚¯ãƒªã‚¢ï¼ˆæ¨å¥¨ï¼‰

Supabase Dashboard â†’ SQL Editor ã§å®Ÿè¡Œ:

```sql
DELETE FROM subscriptions;
DELETE FROM user_subscriptions;
DELETE FROM stripe_customers;
```

---

### ç§ãŒã‚„ã‚‹ã“ã¨

#### 1. ç§»è¡Œã‚¹ã‚¯ãƒªãƒ—ãƒˆã®æœ€çµ‚èª¿æ•´

- CSV ã®æ§‹é€ ã«åˆã‚ã›ãŸèª¿æ•´
- ã‚¨ãƒ©ãƒ¼ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°ã®å¼·åŒ–
- ãƒ­ã‚°å‡ºåŠ›ã®æ”¹å–„

#### 2. ãƒ†ã‚¹ãƒˆå®Ÿè¡Œã®ã‚µãƒãƒ¼ãƒˆ

- ã‚µãƒ³ãƒ—ãƒ«ãƒ‡ãƒ¼ã‚¿ã§ã®å‹•ä½œç¢ºèª
- ã‚¨ãƒ©ãƒ¼è§£æ
- ãƒ‡ãƒ¼ã‚¿æ¤œè¨¼

#### 3. ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆä½œæˆ

- ç§»è¡Œæ‰‹é †æ›¸ã®è©³ç´°ç‰ˆ
- ãƒˆãƒ©ãƒ–ãƒ«ã‚·ãƒ¥ãƒ¼ãƒ†ã‚£ãƒ³ã‚°ã‚¬ã‚¤ãƒ‰
- ãƒ­ãƒ¼ãƒ«ãƒãƒƒã‚¯æ‰‹é †

---

## â° ã‚¹ã‚±ã‚¸ãƒ¥ãƒ¼ãƒ«ï¼ˆç›®å®‰ï¼‰

| ãƒ•ã‚§ãƒ¼ã‚º           | å†…å®¹                                      | æ‰€è¦æ™‚é–“ |
| ------------------ | ----------------------------------------- | -------- |
| **æº–å‚™**           | ãƒ‡ãƒ¼ã‚¿ã‚¨ã‚¯ã‚¹ãƒãƒ¼ãƒˆã€Service Role Key å–å¾— | 30 åˆ†    |
| **ã‚¹ã‚¯ãƒªãƒ—ãƒˆèª¿æ•´** | CSV ã«åˆã‚ã›ãŸèª¿æ•´                        | 2-3 æ™‚é–“ |
| **ã‚µãƒ³ãƒ—ãƒ«ãƒ†ã‚¹ãƒˆ** | 10 ä»¶ã§ãƒ†ã‚¹ãƒˆå®Ÿè¡Œ                         | 1 æ™‚é–“   |
| **æœ¬ç•ªç§»è¡Œ**       | å…¨ãƒ‡ãƒ¼ã‚¿ç§»è¡Œ                              | 2-3 æ™‚é–“ |
| **æ¤œè¨¼**           | ãƒ‡ãƒ¼ã‚¿ç¢ºèªã€ä¿®æ­£                          | 2-3 æ™‚é–“ |
| **ä¸¦è¡Œç¨¼åƒ**       | ä¸¡ã‚µã‚¤ãƒˆã§ãƒ†ã‚¹ãƒˆ                          | 1-2 é€±é–“ |

**åˆè¨ˆ**: æº–å‚™å®Œäº†å¾Œã€1 æ—¥ã§ç§»è¡Œå®Œäº†å¯èƒ½

---

## ğŸš¨ ãƒªã‚¹ã‚¯ã¨å¯¾ç­–

### ãƒªã‚¹ã‚¯ 1: ãƒ¡ãƒ¼ãƒ«ã‚¢ãƒ‰ãƒ¬ã‚¹ã®é‡è¤‡

**å¯¾ç­–**: ã‚¨ãƒ©ãƒ¼ãƒ­ã‚°ã«è¨˜éŒ²ã—ã€æ‰‹å‹•ã§ç¢ºèª

### ãƒªã‚¹ã‚¯ 2: CSV ã®å½¢å¼ãŒç•°ãªã‚‹

**å¯¾ç­–**: ã‚µãƒ³ãƒ—ãƒ«ãƒ†ã‚¹ãƒˆã§äº‹å‰ç¢ºèª

### ãƒªã‚¹ã‚¯ 3: ãƒ¬ãƒ¼ãƒˆåˆ¶é™

**å¯¾ç­–**: ãƒãƒƒãƒå‡¦ç† + å¾…æ©Ÿæ™‚é–“

### ãƒªã‚¹ã‚¯ 4: ãƒ‡ãƒ¼ã‚¿ã®ä¸æ•´åˆ

**å¯¾ç­–**: ç§»è¡Œå‰å¾Œã§ã‚«ã‚¦ãƒ³ãƒˆç¢ºèª

---

## âœ… ãƒã‚§ãƒƒã‚¯ãƒªã‚¹ãƒˆ

ç§»è¡Œå‰:

- [â—‹] Stripe ã‹ã‚‰é¡§å®¢ãƒ‡ãƒ¼ã‚¿ã‚’ã‚¨ã‚¯ã‚¹ãƒãƒ¼ãƒˆ (stripe-customers.csv)
- [â—‹] Stripe ã‹ã‚‰ã‚µãƒ–ã‚¹ã‚¯ãƒªãƒ—ã‚·ãƒ§ãƒ³ãƒ‡ãƒ¼ã‚¿ã‚’ã‚¨ã‚¯ã‚¹ãƒãƒ¼ãƒˆ (stripe-subscriptions.csv)
- [â—‹] Supabase Service Role Key ã‚’å–å¾—
- [â—‹] .env ã« SUPABASE_SERVICE_ROLE_KEY ã‚’è¿½åŠ 
- [ãªã—] Supabase ã®ãƒ†ã‚¹ãƒˆãƒ‡ãƒ¼ã‚¿ã‚’ã‚¯ãƒªã‚¢

ç§»è¡Œä¸­:

- [ ] Script 1: Auth ãƒ¦ãƒ¼ã‚¶ãƒ¼ä½œæˆã‚’å®Ÿè¡Œ
- [ ] Script 2: stripe_customers ã‚’å®Ÿè¡Œ
- [ ] Script 3: user_subscriptions ã‚’å®Ÿè¡Œ
- [ ] ã‚¨ãƒ©ãƒ¼ãƒ­ã‚°ã‚’ç¢ºèª
- [ ] ãƒ‡ãƒ¼ã‚¿ä»¶æ•°ã‚’ç¢ºèª

ç§»è¡Œå¾Œ:

- [ ] æ—¢å­˜é¡§å®¢ã§ãƒ­ã‚°ã‚¤ãƒ³ãƒ†ã‚¹ãƒˆ
- [ ] ã‚µãƒ–ã‚¹ã‚¯ãƒªãƒ—ã‚·ãƒ§ãƒ³æƒ…å ±ã®è¡¨ç¤ºç¢ºèª
- [ ] Webhook ã®å‹•ä½œç¢ºèª
- [ ] 1 é€±é–“ã®ä¸¦è¡Œç¨¼åƒ

---

**æ¬¡ã«ã‚„ã‚‹ã“ã¨**: ä¸Šè¨˜ã€Œã‚ãªãŸãŒã‚„ã‚‹ã“ã¨ã€ã® 3 ã¤ã‚’å®Ÿè¡Œã—ã¦ãã ã•ã„ã€‚å®Œäº†ã—ãŸã‚‰æ•™ãˆã¦ãã ã•ã„ï¼
