# æŠ€è¡“ã‚¹ã‚¿ãƒƒã‚¯ãƒãƒƒãƒ”ãƒ³ã‚°

**æœ€çµ‚æ›´æ–°**: 2025-11-28

---

## ğŸ¯ ã“ã®ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã®ç›®çš„

ã€Œã€‡ã€‡ã®æ©Ÿèƒ½ã¯ã©ã“ã«ã‚ã‚‹ã‹ã€ã€Œã€‡ã€‡ã«ã¯ã©ã®æŠ€è¡“ã‚’ä½¿ã£ã¦ã„ã‚‹ã‹ã€ã‚’å³åº§ã«æŠŠæ¡ã§ãã‚‹ã‚ˆã†ã«ã™ã‚‹ã€‚

---

## ğŸ“ æ©Ÿèƒ½ã¨ãƒ•ã‚¡ã‚¤ãƒ«ã®ãƒãƒƒãƒ”ãƒ³ã‚°

### ã‚µãƒ–ã‚¹ã‚¯ãƒªãƒ—ã‚·ãƒ§ãƒ³æ©Ÿèƒ½

| æ©Ÿèƒ½ | ãƒ•ã‚¡ã‚¤ãƒ«ãƒ‘ã‚¹ | ä½¿ç”¨æŠ€è¡“ | èª¬æ˜ |
|------|------------|----------|------|
| ãƒ—ãƒ©ãƒ³é¸æŠç”»é¢ | `app/subscription/plans/page.tsx` | Next.js, Tailwind | ãƒ—ãƒ©ãƒ³ä¸€è¦§è¡¨ç¤º |
| Checkoutä½œæˆ | `supabase/functions/create-checkout/index.ts` | Supabase Edge Functions, Stripe | Checkout Sessionä½œæˆ |
| Webhookå‡¦ç† | `app/api/webhooks/stripe/route.ts` | Next.js API Routes, Stripe | ã‚¤ãƒ™ãƒ³ãƒˆå—ä¿¡ãƒ»å‡¦ç† |
| ã‚µãƒ–ã‚¹ã‚¯çŠ¶æ…‹ç®¡ç† | `lib/stripe/subscription.ts` | TypeScript | ã‚µãƒ–ã‚¹ã‚¯é–¢é€£ãƒ­ã‚¸ãƒƒã‚¯ |
| ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ãƒ†ãƒ¼ãƒ–ãƒ« | Supabase: `subscriptions` | PostgreSQL | ã‚µãƒ–ã‚¹ã‚¯æƒ…å ±ä¿å­˜ |

**ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆ**: `.claude/docs/subscription/`

---

### èªè¨¼æ©Ÿèƒ½ï¼ˆäºˆå®šï¼‰

| æ©Ÿèƒ½ | ãƒ•ã‚¡ã‚¤ãƒ«ãƒ‘ã‚¹ | ä½¿ç”¨æŠ€è¡“ | èª¬æ˜ |
|------|------------|----------|------|
| ãƒ­ã‚°ã‚¤ãƒ³ | `app/(auth)/login/page.tsx` | Next.js, Supabase Auth | ãƒ¡ãƒ¼ãƒ«ãƒ­ã‚°ã‚¤ãƒ³ |
| ä¼šå“¡ç™»éŒ² | `app/(auth)/signup/page.tsx` | Next.js, Supabase Auth | æ–°è¦ç™»éŒ² |

**ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆ**: `.claude/docs/auth/`ï¼ˆäºˆå®šï¼‰

---

### å‹•ç”»ãƒ—ãƒ¬ãƒ¼ãƒ¤ãƒ¼æ©Ÿèƒ½ï¼ˆäºˆå®šï¼‰

| æ©Ÿèƒ½ | ãƒ•ã‚¡ã‚¤ãƒ«ãƒ‘ã‚¹ | ä½¿ç”¨æŠ€è¡“ | èª¬æ˜ |
|------|------------|----------|------|
| å‹•ç”»å†ç”Ÿ | `app/videos/[id]/page.tsx` | Next.js | å‹•ç”»è¦–è´ãƒšãƒ¼ã‚¸ |

**ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆ**: `.claude/docs/video-player/`ï¼ˆäºˆå®šï¼‰

---

## ğŸ› ï¸ ä½¿ç”¨æŠ€è¡“ä¸€è¦§

### ãƒ•ãƒ­ãƒ³ãƒˆã‚¨ãƒ³ãƒ‰

| æŠ€è¡“ | ãƒãƒ¼ã‚¸ãƒ§ãƒ³ | ç”¨é€” | ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆ |
|------|----------|------|------------|
| Next.js | 14.x | ãƒ•ãƒ¬ãƒ¼ãƒ ãƒ¯ãƒ¼ã‚¯ | https://nextjs.org/docs |
| React | 18.x | UIãƒ©ã‚¤ãƒ–ãƒ©ãƒª | https://react.dev |
| TypeScript | 5.x | å‹å®‰å…¨æ€§ | https://www.typescriptlang.org |
| Tailwind CSS | 3.x | ã‚¹ã‚¿ã‚¤ãƒªãƒ³ã‚° | https://tailwindcss.com/docs |

---

### ãƒãƒƒã‚¯ã‚¨ãƒ³ãƒ‰

| æŠ€è¡“ | ç”¨é€” | ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆ |
|------|------|------------|
| Supabase | ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ãƒ»èªè¨¼ãƒ»Edge Functions | https://supabase.com/docs |
| PostgreSQL | ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ | https://www.postgresql.org/docs |
| Stripe | æ±ºæ¸ˆå‡¦ç† | https://stripe.com/docs |

---

### ã‚¤ãƒ³ãƒ•ãƒ©

| æŠ€è¡“ | ç”¨é€” | ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆ |
|------|------|------------|
| Vercel | ãƒ›ã‚¹ãƒ†ã‚£ãƒ³ã‚° | https://vercel.com/docs |
| GitHub | ãƒãƒ¼ã‚¸ãƒ§ãƒ³ç®¡ç† | https://docs.github.com |

---

## ğŸ“¦ ä¸»è¦ãªãƒ©ã‚¤ãƒ–ãƒ©ãƒª

### ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«æ¸ˆã¿

| ãƒ©ã‚¤ãƒ–ãƒ©ãƒª | ç”¨é€” | ã©ã“ã§ä½¿ç”¨ |
|----------|------|----------|
| `@stripe/stripe-js` | Stripe ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆ | ãƒ•ãƒ­ãƒ³ãƒˆã‚¨ãƒ³ãƒ‰ã®æ±ºæ¸ˆå‡¦ç† |
| `stripe` | Stripe ã‚µãƒ¼ãƒãƒ¼SDK | Edge Functionsã€API Routes |
| `@supabase/supabase-js` | Supabase ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆ | å…¨ä½“ |
| `zod` | ãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³ | ãƒ•ã‚©ãƒ¼ãƒ æ¤œè¨¼ã€APIæ¤œè¨¼ |

**package.jsonå‚ç…§**: ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆãƒ«ãƒ¼ãƒˆã®`package.json`

---

## ğŸ—„ï¸ ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ãƒ†ãƒ¼ãƒ–ãƒ«

### subscriptions

**ç”¨é€”**: ãƒ¦ãƒ¼ã‚¶ãƒ¼ã®ã‚µãƒ–ã‚¹ã‚¯ãƒªãƒ—ã‚·ãƒ§ãƒ³æƒ…å ±ã‚’ç®¡ç†

| ã‚«ãƒ©ãƒ å | å‹ | èª¬æ˜ |
|---------|-----|------|
| `id` | uuid | ãƒ—ãƒ©ã‚¤ãƒãƒªã‚­ãƒ¼ |
| `user_id` | uuid | ãƒ¦ãƒ¼ã‚¶ãƒ¼IDï¼ˆforeign keyï¼‰ |
| `stripe_subscription_id` | text | Stripeã®ã‚µãƒ–ã‚¹ã‚¯ãƒªãƒ—ã‚·ãƒ§ãƒ³ID |
| `stripe_customer_id` | text | Stripeã®ã‚«ã‚¹ã‚¿ãƒãƒ¼ID |
| `status` | text | ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹ï¼ˆactive, canceled, etcï¼‰ |
| `price_id` | text | Stripe Price ID |
| `current_period_start` | timestamp | ç¾åœ¨ã®æœŸé–“é–‹å§‹æ—¥ |
| `current_period_end` | timestamp | ç¾åœ¨ã®æœŸé–“çµ‚äº†æ—¥ |
| `cancel_at_period_end` | boolean | æœŸé–“çµ‚äº†æ™‚ã«ã‚­ãƒ£ãƒ³ã‚»ãƒ«ã™ã‚‹ã‹ |
| `created_at` | timestamp | ä½œæˆæ—¥æ™‚ |
| `updated_at` | timestamp | æ›´æ–°æ—¥æ™‚ |

**ãƒã‚¤ã‚°ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³ãƒ•ã‚¡ã‚¤ãƒ«**: `supabase/migrations/YYYYMMDDHHMMSS_create_subscriptions.sql`

---

### usersï¼ˆSupabase Authï¼‰

**ç”¨é€”**: ãƒ¦ãƒ¼ã‚¶ãƒ¼èªè¨¼æƒ…å ±

Supabase Authã«ã‚ˆã£ã¦è‡ªå‹•ç®¡ç†ã•ã‚Œã‚‹ãƒ†ãƒ¼ãƒ–ãƒ«ã€‚

---

## ğŸ”‘ é‡è¦ãªè¨­å®šãƒ•ã‚¡ã‚¤ãƒ«

| ãƒ•ã‚¡ã‚¤ãƒ« | ç”¨é€” | èª¬æ˜ |
|---------|------|------|
| `.env.local` | ç’°å¢ƒå¤‰æ•° | ãƒ­ãƒ¼ã‚«ãƒ«é–‹ç™ºç”¨ã®è¨­å®šå€¤ |
| `.env.local.example` | ç’°å¢ƒå¤‰æ•°ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆ | æ–°è¦é–‹ç™ºè€…å‘ã‘ã‚µãƒ³ãƒ—ãƒ« |
| `lib/env.ts` | ç’°å¢ƒå¤‰æ•°å‹å®šç¾© | TypeScriptã®å‹å®‰å…¨æ€§ |
| `lib/stripe/config.ts` | Stripeè¨­å®š | Price IDãªã©ã®å®šç¾© |
| `supabase/config.toml` | Supabaseè¨­å®š | ãƒ­ãƒ¼ã‚«ãƒ«Supabaseã®è¨­å®š |

**è©³ç´°**: [ç’°å¢ƒå¤‰æ•°å®šç¾©](./environment-variables.md)

---

## ğŸ”„ API ã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆ

### å†…éƒ¨APIï¼ˆNext.js API Routesï¼‰

| ã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆ | ãƒ¡ã‚½ãƒƒãƒ‰ | ç”¨é€” | ãƒ•ã‚¡ã‚¤ãƒ« |
|-------------|---------|------|---------|
| `/api/webhooks/stripe` | POST | Stripe Webhookå—ä¿¡ | `app/api/webhooks/stripe/route.ts` |

---

### å¤–éƒ¨API

| ã‚µãƒ¼ãƒ“ã‚¹ | ã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆ | ç”¨é€” | ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆ |
|---------|-------------|------|------------|
| Stripe | `https://api.stripe.com` | æ±ºæ¸ˆå‡¦ç† | https://stripe.com/docs/api |
| Supabase | ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆURL | ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ãƒ»èªè¨¼ | https://supabase.com/docs |

---

### Supabase Edge Functions

| é–¢æ•°å | ç”¨é€” | ãƒ•ã‚¡ã‚¤ãƒ« | å‘¼ã³å‡ºã—å…ƒ |
|-------|------|---------|-----------|
| `create-checkout` | Checkout Sessionä½œæˆ | `supabase/functions/create-checkout/index.ts` | ãƒ•ãƒ­ãƒ³ãƒˆã‚¨ãƒ³ãƒ‰ |

**å‘¼ã³å‡ºã—æ–¹æ³•**:
```typescript
const { data, error } = await supabase.functions.invoke('create-checkout', {
  body: { priceId: 'price_xxx' }
});
```

---

## ğŸ¨ ãƒ‡ã‚¶ã‚¤ãƒ³ã‚·ã‚¹ãƒ†ãƒ 

### Figma

**ãƒ•ã‚¡ã‚¤ãƒ«URL**: ï¼ˆFigmaãƒ•ã‚¡ã‚¤ãƒ«ã®URLã‚’è¨˜è¼‰ï¼‰

**Figma MCPé€£æº**:
- Figma MCPãƒ„ãƒ¼ãƒ«ã‚’ä½¿ç”¨ã—ã¦ãƒ‡ã‚¶ã‚¤ãƒ³ä»•æ§˜ã‚’å–å¾—
- ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆå®Ÿè£…å‰ã«å¿…ãšFigmaã‚’ç¢ºèª

**ä½¿ã„æ–¹**:
```
# Claude Codeã§ä½¿ç”¨
Figmaãƒ•ã‚¡ã‚¤ãƒ«ã‹ã‚‰ä»•æ§˜ã‚’å–å¾—ã—ã¦ãã ã•ã„
```

---

### ã‚«ãƒ©ãƒ¼ãƒ‘ãƒ¬ãƒƒãƒˆ

å®šç¾©å ´æ‰€: `tailwind.config.ts`

| è‰²å | Tailwindã‚¯ãƒ©ã‚¹ | ç”¨é€” |
|------|---------------|------|
| Primary | `bg-primary` | ãƒ¡ã‚¤ãƒ³ã‚«ãƒ©ãƒ¼ |
| Secondary | `bg-secondary` | ã‚µãƒ–ã‚«ãƒ©ãƒ¼ |
| Accent | `bg-accent` | ã‚¢ã‚¯ã‚»ãƒ³ãƒˆ |

---

## ğŸ” æ©Ÿèƒ½ã‚’æ¢ã™éš›ã®ãƒ•ãƒ­ãƒ¼

### 1. ã“ã®æŠ€è¡“ãƒãƒƒãƒ”ãƒ³ã‚°ã‚’ç¢ºèª
ã€Œã€‡ã€‡æ©Ÿèƒ½ã¯ã©ã“ã«ã‚ã‚‹ã‹ã€ã‚’æŠŠæ¡

### 2. è©²å½“æ©Ÿèƒ½ã®ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã‚’ç¢ºèª
`.claude/docs/æ©Ÿèƒ½å/`å†…ã®ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆ

### 3. å®Ÿè£…ãƒ•ã‚¡ã‚¤ãƒ«ã‚’ç¢ºèª
ãƒãƒƒãƒ”ãƒ³ã‚°è¡¨ã«è¨˜è¼‰ã•ã‚ŒãŸãƒ•ã‚¡ã‚¤ãƒ«ãƒ‘ã‚¹

---

## ğŸ“ æ–°ã—ã„æ©Ÿèƒ½ã‚’è¿½åŠ ã™ã‚‹éš›ã®ãƒ«ãƒ¼ãƒ«

1. **ã“ã®ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã«å¿…ãšè¿½è¨˜**
   - æ©Ÿèƒ½ã¨ãƒ•ã‚¡ã‚¤ãƒ«ã®ãƒãƒƒãƒ”ãƒ³ã‚°
   - ä½¿ç”¨æŠ€è¡“
   - API ã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆ

2. **é–¢é€£ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã‚’ä½œæˆ**
   - `.claude/docs/æ©Ÿèƒ½å/`ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒª
   - README.mdã€ä»•æ§˜æ›¸ã€ã‚¬ã‚¤ãƒ‰ãªã©

3. **ç’°å¢ƒå¤‰æ•°ã‚’è¿½åŠ ã—ãŸå ´åˆ**
   - `environment-variables.md`ã«è¨˜è¼‰
   - `.env.local.example`ã«è¿½åŠ 

---

## ğŸ”„ ã“ã®ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã®æ›´æ–°ã‚¿ã‚¤ãƒŸãƒ³ã‚°

- æ–°ã—ã„æ©Ÿèƒ½ã‚’è¿½åŠ ã—ãŸæ™‚
- ãƒ•ã‚¡ã‚¤ãƒ«æ§‹æˆã‚’å¤‰æ›´ã—ãŸæ™‚
- æ–°ã—ã„ãƒ©ã‚¤ãƒ–ãƒ©ãƒªã‚’è¿½åŠ ã—ãŸæ™‚
- API ã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆã‚’è¿½åŠ ã—ãŸæ™‚

**ã€Œã“ã‚Œã¯ã©ã“ã«ã‚ã‚‹ã‹ï¼Ÿã€ã¨è¿·ã£ãŸã‚‰ã€ã¾ãšã“ã®ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã‚’ç¢ºèªã—ã¦ãã ã•ã„ã€‚**
