# Webflow CMS統合 - 現状のステータス

最終更新: 2025-11-12

## 📊 全体進捗: 25%

### ✅ 完了項目

#### Phase 0: 準備・調査（完了 100%）
- ✅ 現在のSanity構造を分析
- ✅ 技術的実現可能性を調査
- ✅ ユーザーから必要情報を取得
  - ✅ Webflow URL: https://bonoo.webflow.io/
  - ✅ Webflow API トークン（取得済み）
  - ✅ コレクション情報:
    - Series = Lesson相当
    - Videos = Article相当（Collection ID: `6029d027f6cb8852cbce8c75`）
    - Quest = Videos内の `isthisasectiontitle?` フィールドで構造化
  - ✅ フィールド構造（スクリーンショット確認済み）
  - ✅ 選択メカニズム: 特定Seriesを指定、理想は全Series対応
  - ✅ サンプルデータ:
    - Sample Video slug: `slug-three-structures-11`
    - Sample Video ID: `684f8307d2a12ade32efe83c`
  - ✅ プレミアムコンテンツ制御:
    - Webflowに既存の `FreeContent` フィールドを使用
    - ON = 無料、OFF = メンバー限定
    - Edge Functionで論理反転（`isPremium = !free-content`）

#### ドキュメント作成（完了）
- ✅ feasibility-analysis.md - 技術的実現可能性分析
- ✅ user-questions.md - ユーザーへの質問と回答
- ✅ implementation-plan.md - 実装計画
- ✅ poc-plan.md - POC実装計画
- ✅ premium-content-mapping.md - プレミアムコンテンツ実装仕様

---

## ⏳ 進行中のタスク

**なし**（次のPhaseの開始待ち）

---

## 🎯 次にやるべきこと

### Phase 1: Edge Function基盤（優先度: 高）

#### 1.1 環境セットアップ（30分）
- [ ] Webflow API トークンをSupabase Secretsに保存
  ```bash
  # Supabase CLI で実行
  supabase secrets set WEBFLOW_API_TOKEN="<token>"
  ```
- [ ] 環境変数を `.env` に追加
  ```bash
  VITE_WEBFLOW_VIDEOS_COLLECTION_ID=6029d027f6cb8852cbce8c75
  ```

#### 1.2 Edge Function作成（2-3時間）
- [ ] `supabase/functions/webflow-series/` フォルダを作成
- [ ] 以下のファイルを作成:
  - [ ] `index.ts` - メインハンドラー
  - [ ] `webflow-client.ts` - Webflow APIクライアント
  - [ ] `transformer.ts` - Quest構造変換ロジック
  - [ ] `types.ts` - 型定義
  - [ ] `cache.ts` - キャッシュロジック（オプショナル）

#### 1.3 テスト（30分）
- [ ] Edge Functionをローカルでテスト
  ```bash
  supabase functions serve webflow-series
  ```
- [ ] Postman/curlで動作確認
- [ ] サンプルVideoの取得テスト

---

## 📝 保留中のタスク

### Phase 2: POC実装（Edge Function完了後）
- [ ] テストページ作成 (`src/pages/Dev/WebflowTest.tsx`)
- [ ] React Hook作成 (`useWebflowSeries`)
- [ ] 既存Lessonコンポーネントで表示
- [ ] エラーハンドリング

### Phase 3: Sanity統合（POC検証後）
- [ ] Sanity型拡張（`webflowSource` フィールド追加）
- [ ] Sanityスキーマ更新
- [ ] 既存のLessonDetailページに統合
- [ ] 選択メカニズム実装

### Phase 4: 本番化（統合完了後）
- [ ] キャッシュ最適化
- [ ] エラーハンドリング強化
- [ ] パフォーマンス測定・改善
- [ ] ドキュメント更新

---

## 🚀 即座に開始できるタスク

### 1. Webflow API トークンの保存（5分）

**手順**:
1. Supabase Dashboardにアクセス
2. Project Settings → Edge Functions → Secrets
3. 新しいSecretを追加:
   - Name: `WEBFLOW_API_TOKEN`
   - Value: `<ユーザーが提供したトークン>`

または、Supabase CLIを使用:
```bash
supabase secrets set WEBFLOW_API_TOKEN="<token>"
```

### 2. Edge Function基盤の作成開始（2-3時間）

**作業内容**:
- Webflow APIクライアントの実装
- Quest構造変換ロジックの実装
- エラーハンドリング
- 基本的なレスポンス形式の定義

---

## 🔍 確認が必要な項目

### ユーザーに確認
- [ ] Webflow API トークンの権限確認（Read権限があるか）
- [ ] Seriesコレクションの情報:
  - コレクションID
  - フィールド構造
  - Series-Videos間の参照フィールド名
- [ ] 最初にPOCで表示したいSeries:
  - Series名またはID
  - 期待する記事数

### 技術的確認
- [ ] Webflow API v2 の使用（最新版）
- [ ] レート制限の確認（60 requests/minute）
- [ ] Webflow Webhook設定の可能性

---

## 📈 進捗の測定指標

### Phase 1完了条件
- ✅ Edge FunctionでWebflow APIから1つのVideoを取得できる
- ✅ Quest構造変換が正しく動作する
- ✅ Lesson型にマッピングされたJSONを返せる

### Phase 2完了条件
- ✅ `/dev/webflow-test` ページで1つのSeriesを表示できる
- ✅ 既存のLessonDetailコンポーネントと見た目が同じ
- ✅ 動画再生が正常に動作する

### 全体完了条件
- ✅ ユーザーが任意のSeriesをSanityから参照できる
- ✅ パフォーマンス目標達成（2-3秒以内）
- ✅ エラーハンドリングが適切
- ✅ ドキュメントが最新

---

## 🎯 推奨される次のステップ

1. **即座に開始**: Webflow API トークンをSupabase Secretsに保存
2. **Phase 1開始**: Edge Function基盤の作成
3. **動作確認**: サンプルVideoの取得テスト
4. **ユーザー確認**: POCデモを見せて方向性を確認
5. **Phase 2実装**: 既存UI統合

---

## 💡 技術的な決定事項

### 採用したアーキテクチャ
- **ハイブリッド方式**: SanityにWebflow参照を保存、必要時に取得
- **HTMLレンダリング**: PortableText変換は後回し
- **Quest構造再構築**: `isthisasectiontitle?` フィールドでグループ化
- **キャッシュ戦略**: Edge Functionで短期キャッシュ（5-10分）

### 技術スタック
- Supabase Edge Functions (Deno)
- Webflow CMS API v2
- React Query（フロントエンド）
- 既存のSanity構造を維持

---

## 📞 質問・不明点

**現時点での質問**:
1. Webflow API トークンは準備できていますか？
2. 最初にPOCで表示したいSeriesは決まっていますか？
3. すぐにPhase 1を開始してよいですか？

**技術的な質問**:
1. SeriesコレクションのIDが必要です（user-questions.md に記載なし）
2. Series-Videos間の参照フィールド名の確認が必要

---

## 📚 参考ドキュメント

- `.claude/tasks/005-webflow-integration/feasibility-analysis.md` - 技術調査
- `.claude/tasks/005-webflow-integration/implementation-plan.md` - 詳細実装計画
- `.claude/tasks/005-webflow-integration/poc-plan.md` - POC詳細
- `.claude/tasks/005-webflow-integration/user-questions.md` - ユーザー回答まとめ
